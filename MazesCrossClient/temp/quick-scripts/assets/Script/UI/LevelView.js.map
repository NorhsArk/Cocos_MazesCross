{"version":3,"sources":["LevelView.js"],"names":["cc","Class","extends","Component","properties","title","default","type","Label","starts","Node","pageView","PageView","content","levelItem","levelPage","levels","bid","Integer","mid","_lastOpenLid","lastOpenLid","get","set","val","updateCurrpage","gameApplication","Object","lastLid","onLoad","find","getComponent","start","init","string","keys","length","path","getConf","results","initContents","bind","self","SDK","getItem","score","toString","tmpId","arr","push","forEach","tmp_lid","tmp_path","hideAllItem","idx","level","initLevels","_updatePageView","pageNode","instantiate","active","addPage","pageContent","getChildByName","total_level","i","i_str","itemNode","lid","tag","setItem","isOpen","openAllLevel","node","pageAt","Math","ceil","scrollToPage","removeAllPages","onBackBtnClicked","openMainView","soundManager","playSound"],"mappings":"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","file":"LevelView.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\UI","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        title: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n        starts: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        pageView:{\r\n            default: null,\r\n            type: cc.PageView,\r\n        },\r\n        content: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        levelItem: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        levelPage: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        levels:{\r\n            default:{},\r\n        },\r\n        bid:{\r\n            default:0, \r\n            type:cc.Integer,\r\n        },\r\n        mid:{\r\n            default:0,\r\n            type:cc.Integer,\r\n        },\r\n        _lastOpenLid:{\r\n            default:0,\r\n            type:cc.Integer,\r\n        },\r\n        lastOpenLid:{\r\n            get(){\r\n                return this._lastOpenLid;\r\n            },\r\n            set(val){\r\n                this._lastOpenLid = val;\r\n                this.updateCurrpage();\r\n            },\r\n        },\r\n        gameApplication:{\r\n            default:null,\r\n            type:Object\r\n        },\r\n        lastLid:{\r\n            default:0,\r\n            type:cc.Integer,\r\n        },\r\n    },  \r\n\r\n    onLoad: function () {\r\n        this.gameApplication = cc.find(\"GameApplication\").getComponent(\"GameApplication\");\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    init(bid,mid){\r\n        this.title.string = \"\";\r\n\r\n        if((this.levels == null || Object.keys(this.levels).length <= 0) || this.bid != bid || this.mid != mid ){\r\n            this.bid = bid;\r\n            this.mid = mid;\r\n            // cc.log(\"conf/Level/level_\" + bid + '_' + mid)\r\n            var path = \"conf/level_list/level_\" + bid + '_' + mid;\r\n            this.gameApplication.getConf(path,function(results){\r\n                // cc.log(\"results:\",results);\r\n                this.levels = results;\r\n                this.initContents();\r\n            }.bind(this));\r\n\r\n        }else{\r\n            this.bid = bid;\r\n            this.mid = mid;\r\n            this.initContents();\r\n        }\r\n\r\n        var self = this;\r\n        SDK().getItem(bid+\"_\"+mid,function(score){\r\n            self.starts.getComponent(cc.Label).string = score.toString();\r\n\r\n            //预加载上下两关\r\n            var tmpId = score+1;\r\n            var arr = [];\r\n            arr.push(tmpId);\r\n\r\n            if(tmpId > 1){\r\n                arr.push(tmpId-1);\r\n            }\r\n            arr.forEach(function(tmp_lid){\r\n                var tmp_path = \"conf/level_detail/b_\"+bid+\"/\"+mid+\"/\"+tmp_lid;\r\n                // cc.log(\"------tmp_path:\",tmp_path);\r\n                self.gameApplication.getConf(tmp_path,null);\r\n            });\r\n\r\n        }.bind(this));\r\n    },\r\n\r\n    initContents(){\r\n        var self = this;\r\n        self.hideAllItem();\r\n\r\n        this.title.string = self.levels.title;\r\n        this.lastLid = 0;\r\n\r\n        this.bid = self.levels.bid;\r\n        this.mid = self.levels.mid;\r\n        var idx = 1;\r\n        self.levels.levels.forEach(function(level){\r\n            self.initLevels(level,idx);\r\n            idx++;\r\n        });\r\n        this.pageView._updatePageView();\r\n    },\r\n\r\n    initLevels(level,idx){\r\n        if(idx < 1 || idx > 4){\r\n            return;\r\n        }\r\n\r\n        var pageNode = cc.instantiate(this.levelPage);\r\n        pageNode.active = true;\r\n        // cc.log(\"pageNode:\",pageNode);\r\n        this.pageView.addPage(pageNode);\r\n\r\n        var pageContent = pageNode.getChildByName(\"content\");\r\n        // cc.log(\"path\",path)\r\n        var total_level= level['total_level'];\r\n        for(let i = 1;i<=25;i++){\r\n            // var itemNode = cc.instantiate(this.levelItem);\r\n            // itemNode.parent = pageContent;\r\n            let i_str = i.toString();\r\n\r\n            let itemNode = pageContent.getChildByName(i_str);\r\n\r\n            if(i > level['total_level']){\r\n                itemNode.active = false;\r\n            }else{\r\n                let lid = ((idx-1)*25)+i;\r\n                itemNode.tag = lid;\r\n\r\n                //重置\r\n                this.setItem(itemNode,0,false,lid);\r\n\r\n                var self = this;\r\n                \r\n                //判断是否解锁\r\n                SDK().getItem(self.bid+\"_\"+self.mid+\"_\"+lid,function(score){\r\n                    // console.log(\"++++++++++score:\",lid,score);\r\n                    var isOpen = false;\r\n                    if(lid <= self.lastLid+1 || score > 0){\r\n                        isOpen = true;\r\n                        self.setItem(itemNode,score,isOpen,lid);\r\n                    }else if(openAllLevel){\r\n                        self.setItem(itemNode,score,true,lid);\r\n                    }\r\n\r\n                    if(score > 0){\r\n                        self.lastLid = lid;\r\n                    }\r\n                },itemNode,lid);\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    setItem(node,score,isOpen,lid){\r\n        // cc.log(\"node:\",node,isOpen)\r\n        cc.find(\"unlock\",node).active = isOpen;\r\n        cc.find(\"lock\",node).active = !isOpen;\r\n        cc.find(\"unlock/text\",node).getComponent(cc.Label).string = lid;\r\n        cc.find(\"lock/text\",node).getComponent(cc.Label).string = lid;\r\n\r\n        node.active = true;\r\n        // cc.find(\"stars/1\",node).active = score>=1;\r\n        // cc.find(\"stars/2\",node).active = score>=2;\r\n        // cc.find(\"stars/3\",node).active = score>=3;\r\n\r\n        if(isOpen){\r\n            this.lastOpenLid = lid;\r\n        }\r\n    },\r\n\r\n    updateCurrpage(){\r\n        var pageAt =  Math.ceil(this.lastOpenLid/30) - 1; \r\n        pageAt = pageAt>=0?pageAt:0;\r\n        // setCurrentPageIndex\r\n        this.pageView.scrollToPage(pageAt,false);\r\n    },\r\n\r\n    \r\n\r\n    hideAllItem(){\r\n        this.pageView.removeAllPages();\r\n    },\r\n\r\n    onBackBtnClicked(){\r\n        this.hideAllItem();   \r\n        this.gameApplication.openMainView();\r\n        this.gameApplication.soundManager.playSound(\"btn_click\");\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}