{"version":3,"sources":["..\\..\\..\\..\\..\\packages\\i18n\\runtime-scripts/packages\\i18n\\runtime-scripts\\LocalizedLabel.js"],"names":["i18n","require","debounce","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","cc","Class","extends","Component","editor","executeInEditMode","menu","properties","dataID","get","_dataID","set","val","CC_EDITOR","_debouncedUpdateLabel","updateLabel","onLoad","inst","init","fetchRender","label","getComponent","Label","error","localizedString","t","string"],"mappings":";;;;;;AAAA,IAAMA,OAAOC,QAAQ,cAAR,CAAb;;AAEA;AACA;AACA;AACA;AACA,SAASC,QAAT,CAAkBC,IAAlB,EAAwBC,IAAxB,EAA8BC,SAA9B,EAAyC;AACrC,QAAIC,OAAJ;AACA,WAAO,YAAW;AACd,YAAIC,UAAU,IAAd;AAAA,YAAoBC,OAAOC,SAA3B;AACA,YAAIC,QAAQ,SAARA,KAAQ,GAAW;AACnBJ,sBAAU,IAAV;AACA,gBAAI,CAACD,SAAL,EAAgBF,KAAKQ,KAAL,CAAWJ,OAAX,EAAoBC,IAApB;AACnB,SAHD;AAIA,YAAII,UAAUP,aAAa,CAACC,OAA5B;AACAO,qBAAaP,OAAb;AACAA,kBAAUQ,WAAWJ,KAAX,EAAkBN,IAAlB,CAAV;AACA,YAAIQ,OAAJ,EAAaT,KAAKQ,KAAL,CAAWJ,OAAX,EAAoBC,IAApB;AAChB,KAVD;AAWH;;AAEDO,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,YAAQ;AACJC,2BAAmB,IADf;AAEJC,cAAM;AAFF,KAHH;;AAQLC,gBAAY;AACRC,gBAAQ;AACJC,eADI,iBACG;AACH,uBAAO,KAAKC,OAAZ;AACH,aAHG;AAIJC,eAJI,eAICC,GAJD,EAIM;AACN,oBAAI,KAAKF,OAAL,KAAiBE,GAArB,EAA0B;AACtB,yBAAKF,OAAL,GAAeE,GAAf;AACA,wBAAIC,SAAJ,EAAe;AACX,6BAAKC,qBAAL;AACH,qBAFD,MAEO;AACH,6BAAKC,WAAL;AACH;AACJ;AACJ;AAbG,SADA;AAgBRL,iBAAS;AAhBD,KARP;;AA2BLM,UA3BK,oBA2BK;AACN,YAAGH,SAAH,EAAc;AACV,iBAAKC,qBAAL,GAA6B3B,SAAS,KAAK4B,WAAd,EAA2B,GAA3B,CAA7B;AACH;AACD,YAAI,CAAC9B,KAAKgC,IAAV,EAAgB;AACZhC,iBAAKiC,IAAL;AACH;AACD;AACA,aAAKC,WAAL;AACH,KApCI;AAsCLA,eAtCK,yBAsCU;AACX,YAAIC,QAAQ,KAAKC,YAAL,CAAkBrB,GAAGsB,KAArB,CAAZ;AACA,YAAIF,KAAJ,EAAW;AACP,iBAAKA,KAAL,GAAaA,KAAb;AACA,iBAAKL,WAAL;AACA;AACH;AACJ,KA7CI;AA+CLA,eA/CK,yBA+CU;AACX,YAAI,CAAC,KAAKK,KAAV,EAAiB;AACbpB,eAAGuB,KAAH,CAAS,+DAAT;AACA;AACH;AACD,YAAIC,kBAAkBvC,KAAKwC,CAAL,CAAO,KAAKjB,MAAZ,CAAtB;AACA,YAAIgB,eAAJ,EAAqB;AACjB,iBAAKJ,KAAL,CAAWM,MAAX,GAAoBzC,KAAKwC,CAAL,CAAO,KAAKjB,MAAZ,CAApB;AACH;AACJ;AAxDI,CAAT","file":"LocalizedLabel.js","sourceRoot":"..\\..\\..\\..\\..\\packages\\i18n\\runtime-scripts","sourcesContent":["const i18n = require('LanguageData');\r\n\r\n// Returns a function, that, as long as it continues to be invoked, will not\r\n// be triggered. The function will be called after it stops being called for\r\n// N milliseconds. If `immediate` is passed, trigger the function on the\r\n// leading edge, instead of the trailing.\r\nfunction debounce(func, wait, immediate) {\r\n    var timeout;\r\n    return function() {\r\n        var context = this, args = arguments;\r\n        var later = function() {\r\n            timeout = null;\r\n            if (!immediate) func.apply(context, args);\r\n        };\r\n        var callNow = immediate && !timeout;\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(later, wait);\r\n        if (callNow) func.apply(context, args);\r\n    };\r\n}\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    editor: {\r\n        executeInEditMode: true,\r\n        menu: 'i18n/LocalizedLabel'\r\n    },\r\n\r\n    properties: {\r\n        dataID: {\r\n            get () {\r\n                return this._dataID;\r\n            },\r\n            set (val) {\r\n                if (this._dataID !== val) {\r\n                    this._dataID = val;\r\n                    if (CC_EDITOR) {\r\n                        this._debouncedUpdateLabel();\r\n                    } else {\r\n                        this.updateLabel();\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        _dataID: ''\r\n    },\r\n    \r\n    onLoad () {\r\n        if(CC_EDITOR) {\r\n            this._debouncedUpdateLabel = debounce(this.updateLabel, 200);\r\n        }\r\n        if (!i18n.inst) {\r\n            i18n.init();\r\n        }\r\n        // cc.log('dataID: ' + this.dataID + ' value: ' + i18n.t(this.dataID));\r\n        this.fetchRender();\r\n    },\r\n\r\n    fetchRender () {\r\n        let label = this.getComponent(cc.Label);\r\n        if (label) {\r\n            this.label = label;\r\n            this.updateLabel();\r\n            return;\r\n        } \r\n    },\r\n\r\n    updateLabel () {\r\n        if (!this.label) {\r\n            cc.error('Failed to update localized label, label component is invalid!');\r\n            return;\r\n        }\r\n        let localizedString = i18n.t(this.dataID);\r\n        if (localizedString) {\r\n            this.label.string = i18n.t(this.dataID);\r\n        }\r\n    }\r\n});"]}