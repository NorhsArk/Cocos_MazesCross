{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\SDK/assets\\Script\\SDK\\facebook.js"],"names":["Utils","require","SDK_AD","GAME_CHECK_URL","GAME_RECOMMEND_URL","GAME_STAT_URL","ELoadState","AD_LOADING","AD_LOAD_SUCCESS","AD_LOAD_FAIL","AD_COMPLETE","sdkADName","video_ad_ids","interstitial_ad_ids","game_id","interstitialCount","videoOn","interstitialOn","interstitialOp","rankName_friends","rankName_world","MyPlayer","FB_SDK","cb","videoAd","videoAdState","InterstitialAd","InterstitialAdState","playTimes","sdk_ad","prototype","init","initOP","FBInstant","i18n","loadVideoAd","loadInterstitialAd","name","player","getName","cc","loader","load","getPhoto","err","texture","head","SpriteFrame","id","getID","locale","getLocale","self","xhr","XMLHttpRequest","onreadystatechange","readyState","status","response","JSON","parse","responseText","console","log","code","data","interstitial_op","interstitial_count","video_on","interstitial_on","setUp","open","SDK","getGameId","setRequestHeader","send","sdkADNode","find","getComponent","reLoadOpAd","rows","pic","pic3","gid","setAd","getRecommendGames","amount","getItem","key","score","sys","localStorage","getDataAsync","then","setItem","param","p","setDataAsync","canCreateShortcutAsync","canCreateShortcut","createShortcutAsync","catch","switchGameAsync","e","getCatalogAsync","payments","catalog","purchaseAsync","productID","developerPayload","purchase","getPurchasesAsync","purchases","consumePurchaseAsync","purchaseToken","share","context","chooseAsync","doShare","en_text","cn_text","framePath","loadRes","Texture2D","canvas","document","createElement","ctx","getContext","width","height","image","getHtmlElementObj","drawImage","base64Picture","toDataURL","updateAsync","action","cta","template","text","myReplayData","strategy","notification","shareBestScore3Times","t","now","Math","floor","Date","shareBestScore","isCompleted","bind","plusPlayTimes","getInterstitialCount","delayTime","random","setTimeout","showInterstitialAd","openVideoAd","openinterstitialAd","isPlayOpAD","test","random0To1","getInterstitialAdAsync","interstitial","loadAsync","noOp","GetRandomNum","show","stat","showAsync","getRewardedVideoAsync","rewardedVideo","hasVideoAd","showVideoAd","type","playWith","createAsync","getSelfInfo","setRankScore","extra","rankName","contextID","getType","getLeaderboardAsync","leaderboard","setScoreAsync","error","getRankScore","getPlayerEntryAsync","info","entry","getPlayer","no","getRank","getScore","headUrl","getPercent","getEntryCountAsync","count","num","offset","playerList","getEntriesAsync","i","entries","length","getFriendsRank","getConnectedPlayerEntriesAsync","No","postRankToMessage","module","exports","instance"],"mappings":"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","file":"facebook.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\SDK","sourcesContent":["var Utils = require(\"./utils/SDKUtils\");\r\nvar SDK_AD = require(\"./script/sdk_ad\");\r\nvar GAME_CHECK_URL = \"https://haiwai.31home.com:8003/games.detail\";\r\nvar GAME_RECOMMEND_URL = \"https://haiwai.31home.com:8003/games.recommend\";\r\nvar GAME_STAT_URL = \"https://haiwai.31home.com:8003/games.stat\";\r\n\r\nvar ELoadState = {\r\n    AD_LOADING: \"AD_LOADING\",\r\n    AD_LOAD_SUCCESS: \"AD_LOAD_SUCCESS\",\r\n    AD_LOAD_FAIL: \"AD_LOAD_FAIL\",\r\n    AD_COMPLETE: \"AD_COMPLETE\"\r\n};\r\n\r\n//SDK广告node的路径\r\nvar sdkADName = \"Canvas/sdk_ad\";\r\n//视频广告ID\r\nvar video_ad_ids = '281530152603837_281532319270287';\r\n//插屏广告ID\r\nvar interstitial_ad_ids = '281530152603837_281531689270350';\r\n//游戏ID\r\nvar game_id = \"281530152603837\";\r\n\r\n\r\n//广告配置为默认配置，进入游戏后会加载服务器配置，如果服务器读取失败，使用默认配置。\r\n//每玩N局播一次插屏广告，如果<=1，代表每次播放\r\nvar interstitialCount = 2;\r\n//是否播放视频广告\r\nvar videoOn = 1;\r\n//是否播放插屏广告\r\nvar interstitialOn = 1;\r\n//是否播放互推插屏广告\r\nvar interstitialOp = 0;\r\n//好友榜单名（目前暂时不用）\r\nvar rankName_friends = \"Friends\";\r\n//世界榜单名\r\nvar rankName_world = \"World\";\r\n\r\nvar MyPlayer = {}\r\n\r\nvar FB_SDK = function () {\r\n    this.cb = null;\r\n    this.videoAd = null;\r\n    this.videoAdState = null;\r\n    this.InterstitialAd = null;\r\n    this.InterstitialAdState = null;\r\n    this.playTimes = 0;\r\n\r\n    this.sdk_ad = null;\r\n};\r\n\r\n/**\r\n * =========================================================\r\n    * 初始化\r\n * =========================================================\r\n**/\r\n\r\n/**\r\n    初始化\r\n    1）执行初始化服务器配置\r\n    2）加载视频广告、插屏广告\r\n    3）设置语言\r\n*/\r\nFB_SDK.prototype.init = function () {\r\n\r\n    this.initOP();\r\n    if (typeof FBInstant === 'undefined') {\r\n        const i18n = require('LanguageData');\r\n        // i18n.init('zh');\r\n        //i18n.init('en');\r\n        return;\r\n\r\n    }\r\n    // console.log(\"playerID\",FBInstant.player.getID());\r\n    this.playTimes = 0;\r\n\r\n    //预加载视频广告和插屏广告\r\n    this.loadVideoAd();\r\n    this.loadInterstitialAd();\r\n\r\n    MyPlayer.name = FBInstant.player.getName();\r\n    cc.loader.load(FBInstant.player.getPhoto(), function (err, texture) {\r\n        MyPlayer.head = new cc.SpriteFrame(texture);\r\n    });\r\n    MyPlayer.id = FBInstant.player.getID();\r\n\r\n    var locale = this.getLocale(); // 'en_US'\r\n    /* //根据语言配置\r\n    if (locale == 'zh_CN') {\r\n        const i18n = require('LanguageData');\r\n        i18n.init('zh');\r\n    } else {\r\n        const i18n = require('LanguageData');\r\n        i18n.init('en');\r\n    } */\r\n};\r\n\r\n/**\r\n * 初始化服务器对游戏的配置\r\n**/\r\nFB_SDK.prototype.initOP = function () {\r\n\r\n    //从服务器加载初始化数据\r\n    // cc.log(\"[gameCheck]\" + GAME_CHECK_URL);\r\n    var self = this;\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState == 4 && (xhr.status == 200)) {\r\n            var response = JSON.parse(xhr.responseText);\r\n            console.log(\"response\", response);\r\n            var code = response.code;\r\n            if (code != 500) {\r\n                // cb(true,response);\r\n\r\n                var data = response.data;\r\n\r\n                var interstitial_op = data.interstitial_op;     //每10局显示几次互推\r\n                var interstitial_count = data.interstitial_count;  //每多少局显示一次插屏广告\r\n                var video_on = data.video_on;    //是否显示视频广告\r\n                var interstitial_on = data.interstitial_on;   //是否显示插屏广告\r\n                self.setUp(video_on, interstitial_on, interstitial_count, interstitial_op);\r\n            }\r\n        }\r\n    };\r\n\r\n    xhr.open(\"GET\", GAME_CHECK_URL + \"?game_id=\" + SDK().getGameId(), true);\r\n    xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n    xhr.send();\r\n};\r\n\r\n\r\n/**\r\n * 根据后台配置，设置属性\r\n**/\r\nFB_SDK.prototype.setUp = function (video_on, interstitial_on, interstitial_count, interstitial_op) {\r\n    // console.log(\"setUp__interstitialCount\",interstitial_count)\r\n    // console.log(\"interstitialCount\",interstitialCount)\r\n    interstitialCount = interstitial_count;\r\n    videoOn = video_on;\r\n    interstitialOn = interstitial_on;\r\n    interstitialOp = interstitial_op;\r\n\r\n    // console.log(\"interstitialCount:\",interstitialCount);\r\n    if (interstitialOn >= 1 && interstitialOp >= 1) {\r\n        var sdkADNode = cc.find(sdkADName);\r\n        if (sdkADNode != null) {\r\n            this.sdk_ad = sdkADNode.getComponent(SDK_AD);\r\n        }\r\n\r\n        //加载互推广告\r\n        this.reLoadOpAd();\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * 重新加载互推插屏广告\r\n**/\r\nFB_SDK.prototype.reLoadOpAd = function () {\r\n\r\n    if (this.sdk_ad != null && interstitialOn >= 1 && interstitialOp >= 1) {\r\n        var self = this;\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4 && (xhr.status == 200)) {\r\n                var response = JSON.parse(xhr.responseText);\r\n                // console.log(\"______________response\",response);\r\n                var code = response.code;\r\n                if (code != 500) {\r\n                    // cb(true,response);\r\n                    var data = response.data.rows[0];\r\n                    if (data != null) {\r\n                        var pic = data.pic3;\r\n                        var gid = data.game_id;\r\n                        self.sdk_ad.setAd(pic, gid);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        xhr.open(\"GET\", GAME_RECOMMEND_URL + \"?game_id=\" + game_id + \"&amount=1\", true);\r\n        xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n        xhr.send();\r\n\r\n        // console.log(GAME_RECOMMEND_URL + \"?game_id=\"+game_id +\"&amount=1\")\r\n    }\r\n};\r\n\r\n/**\r\n * 重新加载互推插屏广告\r\n**/\r\nFB_SDK.prototype.getRecommendGames = function (amount, cb) {\r\n\r\n    var self = this;\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState == 4 && (xhr.status == 200)) {\r\n            var response = JSON.parse(xhr.responseText);\r\n            // console.log(\"______________response\",response);\r\n            var code = response.code;\r\n            if (code != 500) {\r\n                if (cb != null) {\r\n                    cb(true, response);\r\n                }\r\n            } else {\r\n                if (cb != null) {\r\n                    cb(false, {});\r\n                }\r\n\r\n            }\r\n        }\r\n    };\r\n\r\n    xhr.open(\"GET\", GAME_RECOMMEND_URL + \"?game_id=\" + game_id + \"&amount=\" + amount, true);\r\n    xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n    xhr.send();\r\n\r\n    //console.log(GAME_RECOMMEND_URL + \"?game_id=\" + game_id + \"&amount=\" + amount)\r\n};\r\n\r\n\r\n/**\r\n * =========================================================\r\n    * 保存、读取数据\r\n * =========================================================\r\n**/\r\n\r\n/**\r\n * 获得用户属性（一般来说可以获得设置的分数，以及用户的其他属性）\r\n**/\r\nFB_SDK.prototype.getItem = function (key, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        var score = JSON.parse(cc.sys.localStorage.getItem(key));\r\n        if (typeof score === 'undefined' || score == null) {\r\n            score = 0;\r\n        }\r\n        cb(score, key);\r\n    } else {\r\n        var score = 0;\r\n        FBInstant.player\r\n            .getDataAsync(['' + key])\r\n            .then(function (data) {\r\n                //console.log('data is loaded',key,data[key]);\r\n                if (typeof data[key] === 'undefined') {\r\n                    score = 0;\r\n                    //console.log(key+\"+null\")\r\n                } else {\r\n                    score = data[key];\r\n                }\r\n                cb(score, key);\r\n            });\r\n    }\r\n};\r\n\r\n\r\n\r\n/**\r\n * 设置属性，如记录分数、记录各类和用户相关的属性\r\n * param要传递一个对象进来，如{score:100}\r\n**/\r\nFB_SDK.prototype.setItem = function (param, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        for (var p in param) {//遍历json对象的每个key/value对,p为key\r\n            // cc.log(\"setScore:\"+ p + \"_\" + param[p]);\r\n            cc.sys.localStorage.setItem(p, param[p]);\r\n        }\r\n        // \r\n        if (cb != null) {\r\n            cb();\r\n        }\r\n    } else {\r\n        FBInstant.player\r\n            .setDataAsync(param)\r\n            .then(function () {\r\n                if (cb != null) {\r\n                    cb();\r\n                }\r\n                // console.log('------------data is set',param);\r\n            });\r\n    }\r\n};\r\n\r\n/**\r\n * =========================================================\r\n    * 基础接口\r\n * =========================================================\r\n**/\r\n\r\n/**\r\n * 获得用户的国家地区语言\r\n**/\r\nFB_SDK.prototype.getLocale = function () {\r\n    if (typeof FBInstant === 'undefined') return;\r\n\r\n    return FBInstant.getLocale();\r\n};\r\n\r\n/**\r\n * 获得游戏ID\r\n**/\r\nFB_SDK.prototype.getGameId = function () {\r\n    return game_id;\r\n};\r\n\r\n/**\r\n * 获得玩家昵称\r\n**/\r\nFB_SDK.prototype.getName = function () {\r\n    if (typeof FBInstant === 'undefined') return \"undefined\";\r\n    return FBInstant.player.getName();\r\n};\r\n\r\n/**\r\n * 创建桌面快捷方式\r\n**/\r\nFB_SDK.prototype.canCreateShortcutAsync = function (cb) {\r\n    if (typeof FBInstant === 'undefined') return;\r\n\r\n    FBInstant.canCreateShortcutAsync()\r\n        .then(function (canCreateShortcut) {\r\n            if (canCreateShortcut) {\r\n                FBInstant.createShortcutAsync()\r\n                    .then(function () {\r\n                        // Shortcut created\r\n                        if (cb != null) {\r\n                            cb(true);\r\n                        }\r\n                    })\r\n                    .catch(function () {\r\n                        // Shortcut not created\r\n                        if (cb != null) {\r\n                            cb(false);\r\n                        }\r\n                    });\r\n            } else {\r\n                if (cb != null) {\r\n                    cb(false);\r\n                }\r\n            }\r\n        });\r\n};\r\n\r\n/**\r\n * 切换到别的游戏（互推游戏）\r\n**/\r\nFB_SDK.prototype.switchGameAsync = function (game_id) {\r\n    if (typeof FBInstant === 'undefined') return false;\r\n    FBInstant.switchGameAsync(game_id).catch(function (e) {\r\n        // Handle game change failure\r\n    });\r\n};\r\n\r\n/**\r\n * =========================================================\r\n    * 支付相关\r\n * =========================================================\r\n**/\r\n\r\n/**\r\n * 获取游戏商品目录\r\n * （列表是后台添加的列表）\r\n**/\r\nFB_SDK.prototype.getCatalogAsync = function (cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb != null) {\r\n            cb([]);\r\n        }\r\n        return;\r\n    }\r\n\r\n    FBInstant.payments.getCatalogAsync().then(function (catalog) {\r\n        console.log(catalog); // [{productID: '12345', ...}, ...]\r\n        cb(catalog);\r\n    });\r\n};\r\n\r\n/**\r\n * 支付\r\n * 支付成功后，返回支付订单。然后调用consumePurchaseAsync使用，使用后发放道具。\r\n**/\r\nFB_SDK.prototype.purchaseAsync = function (productID, developerPayload, cb) {\r\n\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb != null) {\r\n            cb(false, null);\r\n        }\r\n        return;\r\n    }\r\n\r\n    FBInstant.payments.purchaseAsync({\r\n        productID: productID,\r\n        developerPayload: developerPayload,\r\n    }).then(function (purchase) {\r\n        console.log(true, purchase);\r\n        cb(purchase);\r\n        // {productID: '12345', purchaseToken: '54321', developerPayload: 'foobar', ...}\r\n    }).catch(function (e) {\r\n        cb(false, null);\r\n    });\r\n};\r\n\r\n/**\r\n * 获取未消费的支付列表\r\n * (可能出现的原因是，支付成功后，断网或没有拿到订单)\r\n * 即：每次进入游戏后，应该请求一下是否有已支付未消费的订单。\r\n**/\r\nFB_SDK.prototype.getPurchasesAsync = function (cb) {\r\n\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb != null) {\r\n            cb(false, null);\r\n        }\r\n        return;\r\n    }\r\n\r\n    FBInstant.payments.getPurchasesAsync().then(function (purchases) {\r\n        cb(purchases);\r\n        // [{productID: '12345', ...}, ...]\r\n    }).catch(function (e) {\r\n        cb([]);\r\n    });\r\n};\r\n\r\n\r\n/**\r\n * 消费已支付的订单（一定要在发物品、道具之前调用这个接口，返回成功后才能发放物品）\r\n * purchaseToken 为支付成功的purchaseToken\r\n**/\r\nFB_SDK.prototype.consumePurchaseAsync = function (purchaseToken, cb) {\r\n\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb != null) {\r\n            cb(false, null);\r\n        }\r\n        return;\r\n    }\r\n\r\n    FBInstant.payments.consumePurchaseAsync(purchaseToken).then(function () {\r\n        // Purchase successfully consumed!\r\n        // Game should now provision the product to the player\r\n        cb(true);\r\n    }).catch(function (e) {\r\n        cb(false);\r\n    });\r\n};\r\n\r\n\r\n\r\n/**\r\n * =========================================================\r\n    * 分享\r\n * =========================================================\r\n**/\r\n\r\n\r\n/**\r\n * 分享分数\r\n**/\r\nFB_SDK.prototype.share = function (score, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb != null) {\r\n            cb(true);\r\n        }\r\n        return;\r\n    }\r\n    var self = this;\r\n\r\n    FBInstant.context\r\n        .chooseAsync()\r\n        .then(function () {\r\n            // console.log(\"FBInstant.context.getID():\",FBInstant.context.getID());\r\n            self.doShare(score);\r\n            if (cb != null) {\r\n                cb(true);\r\n            }\r\n        }\r\n        ).catch(function (e) {\r\n            // console.log(\"catch\",e);\r\n            if (e.code != null && e.code == \"SAME_CONTEXT\") {\r\n                //相同的用户或group，不能再次发消息\r\n                if (cb != null) {\r\n                    cb(false);\r\n                }\r\n            }\r\n        });\r\n};\r\n\r\n/**\r\n * 执行分享动作\r\n * 并读取resources/texture2d/game_icon.png 作为分享图片\r\n**/\r\nFB_SDK.prototype.doShare = function (score) {\r\n    var self = this;\r\n    var en_text = self.getName() + \" finish \" + score + \" stars,Can you beat me?\";\r\n    var cn_text = self.getName() + \"向你发起挑战！他已经到了 \" + score + \" 层！\";\r\n    // console.log(\"share:\"+en_text);\r\n\r\n    var framePath = \"texture2d/game_icon\";\r\n    // console.log(\"framePath:\",framePath)\r\n    cc.loader.loadRes(framePath, cc.Texture2D, function (err, texture) {\r\n        let canvas = document.createElement('canvas');\r\n        let ctx = canvas.getContext('2d');\r\n        canvas.width = 600;\r\n        canvas.height = 420;\r\n\r\n        let image = texture.getHtmlElementObj();\r\n        ctx.drawImage(image, 0, 0);\r\n\r\n        var base64Picture = canvas.toDataURL('image/png');\r\n\r\n        FBInstant.updateAsync({\r\n            action: 'CUSTOM',\r\n            cta: 'Play Game',\r\n            template: 'join_fight',\r\n            image: base64Picture,\r\n            text: en_text,\r\n            data: { myReplayData: '...' },\r\n            strategy: 'IMMEDIATE',\r\n            notification: 'NO_PUSH',\r\n        }).then(function () {\r\n            //当消息发送后\r\n            // console.log(\"____当消息发送后\")\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * 每三分钟提示分享，并分享最高分数\r\n * 并读取resources/texture2d/game_icon.png 作为分享图片\r\n**/\r\nFB_SDK.prototype.shareBestScore3Times = function (key) {\r\n    SDK().getItem(\"share_times\", function (t) {\r\n        //如果没有设置过倒计时，那么设置为3分钟\r\n        var now = Math.floor(Date.now() / 1000);\r\n        // console.log(\"t:\",t)\r\n        // console.log(\"t-now:\",t-now)\r\n        if (t == null || t <= 0 || t - now < 0) {\r\n            var param = {};\r\n            param['share_times'] = now + 180;\r\n            SDK().setItem(param, function () {\r\n                SDK().shareBestScore(key);\r\n            });\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 分享最高分数\r\n * 并读取resources/texture2d/game_icon.png 作为分享图片\r\n**/\r\nFB_SDK.prototype.shareBestScore = function (key, cb) {\r\n    if (key == null || key == \"\") {\r\n        key = \"all\";\r\n    }\r\n    this.getItem(key, function (score) {\r\n        SDK().share(score, function (isCompleted) {\r\n            if (cb) {\r\n                cb(isCompleted)\r\n            }\r\n        });\r\n    }.bind(this));\r\n};\r\n\r\n\r\n/**\r\n * =========================================================\r\n    * 广告相关\r\n * =========================================================\r\n**/\r\n\r\n/**\r\n * 游戏次数+1\r\n**/\r\nFB_SDK.prototype.plusPlayTimes = function () {\r\n\r\n    this.playTimes++;\r\n    if ((this.playTimes > 1 && this.playTimes % this.getInterstitialCount() == 0 && this.playTimes >= this.getInterstitialCount()) || (this.getInterstitialCount() <= 1 && this.playTimes > 1)) {\r\n        var delayTime = 200 + Math.random() * 1000;\r\n        setTimeout(function () {\r\n            this.showInterstitialAd(function (isCompleted) {\r\n                console.log(\"播放Done\");\r\n            }, false);\r\n        }.bind(this), delayTime);\r\n    }\r\n\r\n    if(this.playTimes % 5 == 0){\r\n        this.canCreateShortcutAsync();\r\n    }\r\n    if (this.playTimes == 5) {\r\n        this.shareBestScore(\"all\", null);\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * 是否打开视频广告\r\n**/\r\nFB_SDK.prototype.openVideoAd = function () {\r\n    return videoOn >= 1;\r\n};\r\n\r\n/**\r\n * 是否打开插屏广告\r\n**/\r\nFB_SDK.prototype.openinterstitialAd = function () {\r\n    return interstitialOn >= 1;\r\n};\r\n\r\n/**\r\n * 每玩多少局播放一次插屏广告\r\n**/\r\nFB_SDK.prototype.getInterstitialCount = function () {\r\n    return interstitialCount;\r\n};\r\n\r\n//是否显示互推广告（互相推荐自己的游戏）\r\nFB_SDK.prototype.isPlayOpAD = function () {\r\n    var test = cc.random0To1() * 10;\r\n    if (test <= interstitialOp) {\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n};\r\n\r\n/**\r\n * 加载插屏广告\r\n**/\r\nFB_SDK.prototype.loadInterstitialAd = function () {\r\n    if (typeof FBInstant === 'undefined') return;\r\n    if (!this.openinterstitialAd()) {\r\n        return;\r\n    }\r\n\r\n    // console.log(\"loadInterstitialAd\")\r\n    FBInstant.getInterstitialAdAsync(\r\n        interstitial_ad_ids,\r\n    ).then(function (interstitial) {\r\n        // console.log(\"FBInstant.getInterstitialAdAsync:\",interstitial);\r\n        this.InterstitialAd = interstitial;\r\n        this.InterstitialAdState = ELoadState.AD_LOADING;\r\n        return this.InterstitialAd.loadAsync();\r\n    }.bind(this)).catch(function (e) {\r\n        // console.log(\"load.showInterstitialAd catch\");\r\n        // console.log(JSON.stringify(e));\r\n    }.bind(this))\r\n        .then(function () {\r\n            // console.log(\"FBInstant.getInterstitialAdAsync done:\");\r\n            this.InterstitialAdState = ELoadState.AD_LOAD_SUCCESS;\r\n        }.bind(this));\r\n};\r\n\r\n/**\r\n * 播放插屏广告\r\n**/\r\nFB_SDK.prototype.showInterstitialAd = function (cb, noOp) {\r\n\r\n\r\n    // console.log(\"FB_SDK.prototype.showInterstitialAd\",this.InterstitialAd);\r\n    // console.log(\"this.sdk_ad\",this.sdk_ad);\r\n    // console.log(\"interstitialOn\",interstitialOn);\r\n\r\n    if (interstitialOn < 1) {\r\n        return;\r\n    }\r\n\r\n    if ((this.sdk_ad != null && interstitialOp >= 1 && Utils.GetRandomNum(1, 10) <= interstitialOp && !noOp) || (this.InterstitialAd == null && this.sdk_ad != null && !noOp)) {\r\n        // if(this.sdk_ad != null){\r\n        console.log(\"sdk_ad:\", this.sdk_ad)\r\n        this.sdk_ad.show();\r\n\r\n        this.stat(1, this.sdk_ad.game_id);\r\n        if (cb) {\r\n            cb(true);\r\n        }\r\n\r\n        // console.log(\"this.sdk_ad.show()\");\r\n    } else if (this.InterstitialAd != null) {\r\n        if (typeof FBInstant === 'undefined') {\r\n            if (cb) {\r\n                cb(false);\r\n            }\r\n            return;\r\n        };\r\n\r\n        // console.log(\"show Interstitial ad start\");\r\n        this.InterstitialAd.showAsync().then(function () {\r\n            // console.log(\"this.showInterstitialAd.showAsync\");\r\n            this.InterstitialAdState = ELoadState.AD_COMPLETE;\r\n            // this.game.paused = false;\r\n            // window.sounds.toggleMusic(false);\r\n            if (cb) {\r\n                cb(true);\r\n            }\r\n\r\n            // console.log(\"show showInterstitialAd success\");\r\n            this.loadInterstitialAd();\r\n        }.bind(this))\r\n            .catch(function (e) {\r\n                // console.log(\"this.showInterstitialAd catch\");\r\n                this.InterstitialAdState = ELoadState.AD_COMPLETE;\r\n                // this.game.paused = false;\r\n                // window.sounds.toggleMusic(false);\r\n                // console.log(JSON.stringify(e));\r\n                if (cb) {\r\n                    cb(false);\r\n                }\r\n            }.bind(this));\r\n    } else {\r\n        // console.log(\"show showInterstitialAd ad Stop\");\r\n        if (cb) {\r\n            cb(false);\r\n        }\r\n        this.loadInterstitialAd();\r\n    }\r\n};\r\n\r\n/**\r\n * 加载视频广告\r\n**/\r\nFB_SDK.prototype.loadVideoAd = function () {\r\n    if (typeof FBInstant === 'undefined') return;\r\n\r\n    if (!this.openVideoAd()) {\r\n        return;\r\n    }\r\n    // console.log(\"FB_SDK.prototype.loadVideoAd\");\r\n    FBInstant.getRewardedVideoAsync(\r\n        video_ad_ids,\r\n    ).then(function (rewardedVideo) {\r\n        this.videoAd = rewardedVideo;\r\n        this.videoAdState = ELoadState.AD_LOADING;\r\n        return this.videoAd.loadAsync();\r\n    }.bind(this)).then(function () {\r\n        this.videoAdState = ELoadState.AD_LOAD_SUCCESS;\r\n    }.bind(this));\r\n};\r\n\r\n/**\r\n * 是否有视频广告可以播放\r\n**/\r\nFB_SDK.prototype.hasVideoAd = function () {\r\n    if (typeof FBInstant === 'undefined') {\r\n        return false;\r\n    };\r\n\r\n    return this.videoAd != null;\r\n};\r\n\r\n/**\r\n * 播放视频广告\r\n**/\r\nFB_SDK.prototype.showVideoAd = function (cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb) {\r\n            cb(false);\r\n        }\r\n        return;\r\n    };\r\n\r\n    // console.log(\"FB_SDK.prototype.showVideoAd\",this.videoAd);\r\n\r\n    if (this.videoAd != null) {\r\n        // console.log(\"show video ad start\");\r\n        this.videoAd.showAsync().then(function () {\r\n            // console.log(\"this.videoAd.showAsync\");\r\n            this.videoAdState = ELoadState.AD_COMPLETE;\r\n            // this.game.paused = false;\r\n            // window.sounds.toggleMusic(false);\r\n            if (cb) {\r\n                cb(true);\r\n            }\r\n\r\n            // console.log(\"show video ad success\");\r\n            this.loadVideoAd();\r\n        }.bind(this))\r\n            .catch(function (e) {\r\n                // console.log(\"this.videoAd catch\");\r\n                this.videoAdState = ELoadState.AD_COMPLETE;\r\n                // this.game.paused = false;\r\n                // window.sounds.toggleMusic(false);\r\n                // console.log(JSON.stringify(e));\r\n                if (cb) {\r\n                    cb(false);\r\n                }\r\n                this.loadVideoAd();\r\n            }.bind(this));\r\n    } else {\r\n        // console.log(\"show video ad Stop\");\r\n        if (cb) {\r\n            cb(false);\r\n        }\r\n        this.loadVideoAd();\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * =========================================================\r\n    * 统计相关\r\n * =========================================================\r\n**/\r\n\r\n/**\r\n * 统计显示、点击次数（统计自己的互推广告）\r\n**/\r\nFB_SDK.prototype.stat = function (type, gid) {\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState == 4 && (xhr.status == 200)) {\r\n            var response = JSON.parse(xhr.responseText);\r\n            // console.log(\"______________response\",response);\r\n        }\r\n    };\r\n\r\n    xhr.open(\"GET\", GAME_STAT_URL + \"?game_id=\" + gid + \"&type=\" + type, true);\r\n    xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n    xhr.send();\r\n};\r\n\r\n\r\n\r\n\r\n/**\r\n * =========================================================\r\n    * 榜单\r\n * =========================================================\r\n**/\r\n\r\n/**\r\n * 和好友一起玩\r\n * id 好友ID\r\n * score 自己的最高分\r\n * cb callback\r\n**/\r\nFB_SDK.prototype.playWith = function (id, score, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb != null) {\r\n            cb(true);\r\n        }\r\n        return;\r\n    }\r\n    var self = this;\r\n    FBInstant.context\r\n        .createAsync(id)\r\n        .then(function () {\r\n            // console.log(\"FBInstant.context.getID():\",FBInstant.context.getID());\r\n            self.doShare(score);\r\n            if (cb != null) {\r\n                cb(true);\r\n            } else {\r\n                cb(false);\r\n            }\r\n        }).catch(cb(false));\r\n};\r\n\r\n\r\n\r\n\r\n/**\r\n * 获取自身信息\r\n * cb callback\r\n**/\r\nFB_SDK.prototype.getSelfInfo = function (cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        console.log(\"set rank fail\");\r\n        if (cb !== null) {\r\n            cb({});\r\n        }\r\n    } else {\r\n        if (cb != null) {\r\n            cb(MyPlayer);\r\n        }\r\n        return MyPlayer;\r\n    }\r\n}\r\n\r\n/**\r\n * 保存榜单分数\r\n**/\r\nFB_SDK.prototype.setRankScore = function (type, score, extra, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        console.log(\"set rank fail\");\r\n    } else {\r\n        var rankName;\r\n        var contextID = FBInstant.context.getID();\r\n        if (contextID != null) {\r\n            contextID = \".\" + contextID;\r\n        }\r\n        if (type == 1) {\r\n            rankName = rankName_friends;\r\n            if (contextID == null) {\r\n                console.log(FBInstant.context.getType());\r\n                contextID = \"\";\r\n                return;\r\n            }\r\n        } else if (type == 2) {\r\n            rankName = rankName_world;\r\n            contextID = \"\";\r\n        } else {\r\n            if (null != cb) {\r\n                cb(\"wrong type\")\r\n            }\r\n            console.log(\"wrong type\");\r\n            return;\r\n        }\r\n        FBInstant\r\n            .getLeaderboardAsync(rankName + contextID)\r\n            .then(leaderboard => {\r\n                console.log(leaderboard.getName());\r\n                return leaderboard.setScoreAsync(score, extra);\r\n            })\r\n            .then(() => console.log('Score saved'))\r\n            .catch(error => console.error(error));\r\n\r\n    }\r\n};\r\n\r\n/**\r\n * 获取自身的排行榜\r\n**/\r\nFB_SDK.prototype.getRankScore = function (type, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        console.log(\"get self rank fail\");\r\n    } else {\r\n        var rankName;\r\n        var contextID = FBInstant.context.getID();\r\n        if (contextID != null) {\r\n            contextID = \".\" + contextID;\r\n        }\r\n        if (type == 1) {\r\n            rankName = rankName_friends;\r\n            if (contextID == null) {\r\n                console.log(FBInstant.context.getType());\r\n                contextID = \"\";\r\n                return;\r\n            }\r\n        } else if (type == 2) {\r\n            rankName = rankName_world;\r\n            contextID = \"\";\r\n        } else {\r\n            if (null != cb) {\r\n                cb(\"wrong type\")\r\n            }\r\n            console.log(\"wrong type\");\r\n            return;\r\n        }\r\n        FBInstant\r\n            .getLeaderboardAsync(rankName + contextID)\r\n            .then(leaderboard => leaderboard.getPlayerEntryAsync())\r\n            .then(entry => {\r\n                var info = {};\r\n                info.id = entry.getPlayer().getID();\r\n                info.no = entry.getRank();\r\n                info.name = entry.getPlayer().getName();\r\n                info.score = entry.getScore();\r\n                info.headUrl = entry.getPlayer().getPhoto();\r\n                cb(info);\r\n            }).catch(error => console.error(error));\r\n    }\r\n};\r\n\r\n/**\r\n * 获取榜单百分比\r\n**/\r\nFB_SDK.prototype.getPercent = function (cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        console.log(\"get rank fail\");\r\n        if (cb != null) {\r\n            cb();\r\n        }\r\n    } else {\r\n        FBInstant.getLeaderboardAsync('World')\r\n            .then(function (leaderboard) {\r\n                return leaderboard.getEntryCountAsync();\r\n            })\r\n            .then(function (count) {\r\n                if (cb != null) {\r\n                    cb(count);\r\n                }\r\n            });\r\n    }\r\n}\r\n\r\n/**\r\n * 获取榜单\r\n**/\r\nFB_SDK.prototype.getRank = function (type, num, offset, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        console.log(\"get rank fail\");\r\n    } else {\r\n        var rankName;\r\n        var contextID = FBInstant.context.getID();\r\n        if (contextID != null) {\r\n            contextID = \".\" + contextID;\r\n        }\r\n        if (type == 1) {\r\n            rankName = rankName_friends;\r\n            if (contextID == null) {\r\n                console.log(FBInstant.context.getType());\r\n                contextID = \"\";\r\n                if (cb != null) {\r\n                    cb([]);\r\n                }\r\n                return;\r\n            }\r\n        } else if (type == 2) {\r\n            rankName = rankName_world;\r\n            contextID = \"\";\r\n        } else {\r\n            if (null != cb) {\r\n                cb(\"wrong type\")\r\n            }\r\n            console.log(\"wrong type\");\r\n            return;\r\n        }\r\n        var playerList = [];\r\n        FBInstant\r\n            .getLeaderboardAsync(rankName + contextID)\r\n            .then(leaderboard => leaderboard.getEntriesAsync(num, offset))//第一个是获取数量，第二个是起始点\r\n            .then(entries => {\r\n                for (var i = 0; i < entries.length; i++) {\r\n                    playerList[i] = {};\r\n                    playerList[i].id = entries[i].getPlayer().getID();\r\n                    playerList[i].no = entries[i].getRank();\r\n                    playerList[i].name = entries[i].getPlayer().getName();\r\n                    playerList[i].score = entries[i].getScore();\r\n                    playerList[i].headUrl = entries[i].getPlayer().getPhoto();\r\n                    /* console.log(\r\n                        entries[i].getRank() + '. ' +\r\n                        entries[i].getPlayer().getName() + ': ' +\r\n                        entries[i].getScore()+ 'url ' +\r\n                        entries[i].getPlayer().getPhoto()\r\n                    ); */\r\n                }\r\n                if (cb != null) {\r\n                    cb(playerList);\r\n                }\r\n            }).catch(error => console.error(error));\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * 获取好友榜单\r\n * cb callback\r\n**/\r\nFB_SDK.prototype.getFriendsRank = function (type, num, offset, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        console.log(\"getFriendsInfo fail\");\r\n        if (cb != null) {\r\n            cb({});\r\n        }\r\n    } else {\r\n        var rankName;\r\n        var contextID = FBInstant.context.getID();\r\n        if (contextID != null) {\r\n            contextID = \".\" + contextID;\r\n        }\r\n        if (type == 1) {\r\n            rankName = rankName_friends;\r\n            if (contextID == null) {\r\n                console.log(FBInstant.context.getType());\r\n                contextID = \"\";\r\n                if (cb != null) {\r\n                    cb([]);\r\n                }\r\n                return;\r\n            }\r\n        } else if (type == 2) {\r\n            rankName = rankName_world;\r\n            contextID = \"\";\r\n        } else {\r\n            if (null != cb) {\r\n                cb(\"wrong type\")\r\n            }\r\n            console.log(\"wrong type\");\r\n            return;\r\n        }\r\n        var playerList = [];\r\n        FBInstant.getLeaderboardAsync(rankName + contextID).then(\r\n            leaderboard => leaderboard.getConnectedPlayerEntriesAsync(num, offset)\r\n        ).then(function (entries) {\r\n            for (var i = 0; i < entries.length; i = i + 1) {\r\n                playerList[i] = {};\r\n                playerList[i].id = entries[i].getPlayer().getID();\r\n                playerList[i].name = entries[i].getPlayer().getName();\r\n                playerList[i].headUrl = entries[i].getPlayer().getPhoto();\r\n                playerList[i].No = entries[i].getRank();\r\n                playerList[i].score = entries[i].getScore();\r\n            }\r\n            if (cb != null) {\r\n                cb(playerList);\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * \r\n**/\r\nFB_SDK.prototype.postRankToMessage = function (type, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        console.log(\"post rank fail\");\r\n    } else {\r\n        var rankName;\r\n        var contextID = FBInstant.context.getID();\r\n        if (contextID != null) {\r\n            contextID = \".\" + contextID;\r\n        }\r\n        if (type == 1) {\r\n            rankName = rankName_friends;\r\n            if (contextID == null) {\r\n                console.log(FBInstant.context.getType());\r\n                contextID = \"\";\r\n                return;\r\n            }\r\n        } else if (type == 2) {\r\n            rankName = rankName_world;\r\n            contextID = \"\";\r\n        } else {\r\n            if (null != cb) {\r\n                cb(\"wrong type\")\r\n            }\r\n            console.log(\"wrong type\");\r\n            return;\r\n        }\r\n        FBInstant.updateAsync({\r\n            action: 'LEADERBOARD',\r\n            name: rankName + contextID\r\n        })\r\n            .then(() => console.log('Update Posted'))\r\n            .catch(error => console.error(error));\r\n    }\r\n}\r\n\r\n/**\r\n * =========================================================\r\n    * END\r\n * =========================================================\r\n**/\r\n\r\nmodule.exports = (function () {\r\n    var instance;\r\n    return function () {\r\n        if (!instance) {\r\n            instance = new FB_SDK();\r\n        }\r\n        return instance;\r\n    }\r\n})();\r\n\r\n\r\n"]}