{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\UI\\Game/assets\\Script\\UI\\Game\\GameView.js"],"names":["Utils","require","HexCell","Role","Enemy","Tower","colors","hexTileHeight","sideLength","cc","Class","extends","Component","properties","shootings","default","type","Node","invAgain","mission","gm","title","Label","star1","star2","star3","moves","best","RichText","tileBox","iceBox","maxValidMoves","Integer","visible","movesLeft","moved","leaveSteps","levelDimensions","v2","gridOffset","hexCellPrefab","icePrefab","rolePrefab","enemyPrefab","enemyPrefab1","enemyPrefab2","endPrefab","allCells","allTowers","myRole","enemys","helplines","stepsLines","endObj","selectedLines","mouseIsDown","userInputEnabled","gameOver","prevTilePosition","mouseOffsetPos","touchPos","movePlus","get","helpPath","helpShaked","helpBtn","helpCountLabel","_helpCount","helpCount","set","v","string","toString","param","SDK","setItem","getChildByName","active","shareFriendTip","adSprite","Sprite","receiveGiftNode","giftBtn","preBtn","nextBtn","endView","endView_Stars","endView_title","endView_text","gameApplication","Object","isMoving","lastDirection","turnBackCount","timesNode","timesVal","timesLeft","timeOutflowCB","timeIsUpNode","timeIsUpEndNode","gotMoreTime","opad_game_id","onLoad","node","width","winSize","height","plusMoreHelp","plusHelp","clearHelp","clearData","onEnable","scheduleOnce","init","unschedule","shootingStars","schedule","i","length","shootAnim","delay","random0To1","x","y","GetRandomNum","runAction","moveBy","bind","start","gameApplicationNode","find","getComponent","onBackBtnClicked","on","EventType","TOUCH_START","event","onMouseDown","TOUCH_MOVE","onMouseMove","onDisable","clear","timeOutflow","clearTile","splice","currentLineColor","oldCurrentLineColor","childrenCount","n","children","destroy","self","bid","mid","lid","path","getConf","results","initGame","arr","push","forEach","tmp_lid","tmp_path","initHelpBtn","getItem","count","curIdx","judgeIdx","window","lastPlay","lines","linesCount","levelInfo","grid","createGrid","createRole","initHelpPath","cloneObj","enemy","createEnemy","getSteps","updateUI","t","interval","repeat","axialCoordinate","test","checkXY","canMovePath","checkMovePos","j","testV2","soundManager","playSound","color","hexToColor","hasVideoAd","stopAllAction","getMoreTime","target","Button","interactable","onVideoBtnClick","isCompleted","addTime","coin","coins","showCoinView","getMoreTimeInv","score","share","showInvAgain","restarGame","stopAllActions","helpStart","helpIdx","stepCount","isContinue","hc","getCellByCoordinate","canMove","checkCanMoveCount","checkMove","help","tmpPath","selected","equals","showHelpLine","startV2","isNeighbors","isIce","tmp_coordinate","showStartHelp","showEndHelp","showHelp","update","dt","roundMove","tower","towerShoot","isShooting","bubble","bubbleAxialCoordinate","direction","cb1","callFunc","play","delay0","delayTime","cb2","position","pCompMult","getPosition","opacity","cb4","seq","sequence","scale","nextPos","add","worldPosition","convertToWorldSpaceAR","hcPos_tmp","convertToNodeSpaceAR","hcPos","a1","moveTo","checkMoveDirectionCount","Math","random","idx","getLocation","movePos","offsetX","offsetY","abs","doAction","_coordinate","log","die","playDie","openMainView","showGameOver","curr_star","star","mainScirpt","initStage","saveCount","timeGiftScript","showTimeGiftView","plusStar","setRankScore","all","playTimes","floor","onOpAdClicked","switchGameAsync","checkWin","isWin","moveEnd","inArray","helpBtnShake","setArrow","addSelectedLines","coordinate","pop","hideLine","showStartLine","showEndLine","showLine","manual","hideArrow","isTurnBack","getkMoveDirection","c","neighbors","getNeighborsOBJ","l","d","r","leftActive","rightActive","topActive","bottomActive","tc","dc","b","lc","rc","enemy_GO","instantiate","parent","setScale","setPosition","end","hc1","role_GO","role","end_GO","endNode","gameView","setDark","collisionCallback","_levelDimensions","walls","ices","towers","cb","maxL","max","director","getWinSize","tileBoxSize","getContentSize","tileBoxHeight","hexH","lineWidth","nowHeight","testHexTileHeight","sizeW","sizeH","hexTile","axialPoint","screenPoint","axialToScreen","setContentSize","size","name","zIndex","scaleChild","wx","wy","dx","dy","wall","tmp_w1","tmp_d1","w1","d1","setLeft","setTop","setRight","setBottom","ice","setIce","iceNode","scaleTo","min","setRightTower","pushTower","rightTower","setLeftTower","leftTower","setTopTower","topTower","setBottomTower","bottomTower","config","dict","showStepView","isOk","setStar","f","onNextBtnClicked","btn","nextGame","onPreviousBtnClicked","prevGame","onReStarBtnClicked","onHelpBtnClicked","onWatchVideoBtnClicked","showVideoAd","onShareInvBtnClicked","console","onShareBtnClicked","onCloseWatchVideoTipClicked","shake","onGiftBtnClicked","onPlayInterstitialGiftBtnClicked","showInterstitialAd"],"mappings":"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","file":"GameView.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\UI\\Game","sourcesContent":["var Utils = require(\"../../Utils/Utils\");\r\nvar HexCell = require(\"./HexCell\");\r\nvar Role = require(\"./Role\");\r\nvar Enemy = require(\"./Enemy\");\r\nvar Tower = require(\"./Tower\");\r\n\r\nvar colors = [\r\n    \"#5d3eaf\",\r\n    \"#4ba3e8\",\r\n    \"#9d9e9d\",\r\n    \"#67798a\",\r\n    \"#f19b38\"\r\n];\r\n\r\n\r\nvar hexTileHeight = 100;    //actually the width of the hex tile graphic (distance between the pointy opposite corners)\r\nvar sideLength; //this is the lendth of one side of the hexagon or the length of a corner to centre of the hexagon\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        shootings: {\r\n            default: [],\r\n            type: [cc.Node],\r\n        },\r\n        invAgain: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        mission: {\r\n            default: null,\r\n        },\r\n        gm: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        title: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n        star1: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        star2: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        star3: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        moves: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n        best: {\r\n            default: null,\r\n            type: cc.RichText,\r\n        },\r\n        tileBox: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        iceBox: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        maxValidMoves: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n            visible: false,\r\n        },\r\n        movesLeft: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n            visible: false,\r\n        },\r\n        moved: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n            visible: false,\r\n        },\r\n        leaveSteps: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        //grid size colum x row\r\n        levelDimensions: {\r\n            default: cc.v2(0, 0),\r\n            visible: false,\r\n        },\r\n        //position of the full grid\r\n        gridOffset: {\r\n            default: cc.v2(0, 0),\r\n            visible: false,\r\n        },\r\n        hexCellPrefab: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        icePrefab: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        rolePrefab: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        enemyPrefab: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        enemyPrefab1: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        enemyPrefab2: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        endPrefab: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        //list of all the cells in the grid\r\n        allCells: {\r\n            default: [],\r\n            type: [HexCell],\r\n        },\r\n        allTowers: {\r\n            default: [],\r\n            type: [Tower],\r\n        },\r\n        myRole: {\r\n            default: null,\r\n            type: Role,\r\n        },\r\n        enemys: {\r\n            default: []\r\n        },\r\n        helplines: {\r\n            default: []\r\n        },\r\n        stepsLines: {\r\n            default: []\r\n        },\r\n        endObj: {\r\n            default: null,\r\n            type: Role,\r\n        },\r\n\r\n        selectedLines: {\r\n            default: [],\r\n        },\r\n\r\n        mouseIsDown: false,\r\n        userInputEnabled: false,\r\n        gameOver: false,\r\n\r\n        prevTilePosition: {\r\n            default: cc.v2(-1000, -1000),\r\n            visible: false,\r\n        },\r\n        mouseOffsetPos: {\r\n            default: cc.v2(0, 0),\r\n            visible: false,\r\n        },\r\n        touchPos: {\r\n            default: cc.v2(0, 0),\r\n            visible: false,\r\n        },\r\n\r\n        movePlus: {\r\n            get: function () {\r\n                //t,l,d,r\r\n                return [\r\n                    cc.v2(0, 1), //top\r\n                    cc.v2(-1, 0), //left\r\n                    cc.v2(0, -1), //down\r\n                    cc.v2(1, 0)  //right\r\n                ];\r\n            }\r\n        },\r\n\r\n        helpPath: {\r\n            default: [],\r\n        },\r\n        helpShaked: {\r\n            default: [],\r\n        },\r\n        helpBtn: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        helpCountLabel: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n        _helpCount: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n        },\r\n        helpCount: {\r\n            get: function () {\r\n                return this._helpCount;\r\n            },\r\n            set: function (v) {\r\n                this._helpCount = v;\r\n                this.helpCountLabel.string = v.toString();\r\n\r\n                var param = {};\r\n                param[\"my_help\"] = this._helpCount > 0 ? this._helpCount : -1;\r\n                SDK().setItem(param, null);\r\n\r\n                this.helpBtn.getChildByName(\"icon\").active = true;\r\n                this.helpBtn.getChildByName(\"num\").active = true;\r\n\r\n            },\r\n        },\r\n        shareFriendTip: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        adSprite: {\r\n            default: null,\r\n            type: cc.Sprite,\r\n        },\r\n        receiveGiftNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        giftBtn: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        preBtn: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        nextBtn: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        endView: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        endView_Stars: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        endView_title: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n        endView_text: {\r\n            default: null,\r\n            type: cc.RichText,\r\n        },\r\n        gameApplication: {\r\n            default: null,\r\n            type: Object\r\n        },\r\n        isMoving: false,\r\n        //最后行走方向\r\n        lastDirection: {\r\n            default: -1,\r\n            type: cc.Integer,\r\n        },\r\n        turnBackCount: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n        },\r\n        timesNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        timesVal: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n        timesLeft: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n        },\r\n        timeOutflowCB: {\r\n            default: null\r\n        },\r\n        timeIsUpNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        timeIsUpEndNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        gotMoreTime: false,\r\n        opad_game_id: null,\r\n\r\n\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.node.width = cc.winSize.width;\r\n        this.node.height = cc.winSize.height;\r\n    },\r\n\r\n    plusMoreHelp() {\r\n        this.helpCount += plusHelp;\r\n    },\r\n\r\n    clearHelp() {\r\n        this.helpCount = 0;\r\n    },\r\n\r\n    clearData() {\r\n        SDK().clearData();\r\n    },\r\n\r\n    onEnable() {\r\n        this.scheduleOnce(function () {\r\n            this.init();\r\n        }, 0.7)\r\n\r\n        //注册流行事件\r\n        this.unschedule(this.shootingStars);\r\n        this.schedule(this.shootingStars, 4);\r\n    },\r\n\r\n    //流行事件\r\n    shootingStars() {\r\n        for (var i = 0; i < this.shootings.length; i = i + 1) {\r\n            this.shootAnim(this.shootings[i]);\r\n        }\r\n    },\r\n\r\n    //流行动画\r\n    shootAnim(node) {\r\n        var delay = cc.random0To1() * 3;\r\n        node.x = cc.winSize.width + 100;\r\n        node.y = Utils.GetRandomNum(cc.winSize.height * 0.5, cc.winSize.height * 2);\r\n        this.scheduleOnce(function () {\r\n            node.runAction(cc.moveBy(0.5, cc.v2(-(cc.winSize.width * 2.5), -(cc.winSize.width * 2.5))));\r\n        }.bind(this), delay)\r\n    },\r\n\r\n    start() {\r\n        var gameApplicationNode = cc.find(\"GameApplication\");\r\n        if (gameApplicationNode != null) {\r\n            this.gameApplication = gameApplicationNode.getComponent(\"GameApplication\");\r\n        }\r\n\r\n        if (typeof this.gameApplication === 'undefined' || this.gameApplication == null) {\r\n            this.onBackBtnClicked();\r\n            return;\r\n        }\r\n\r\n        this.gm.active = false\r\n\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            this.onMouseDown(event);\r\n        }, this);\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n            this.onMouseMove(event);\r\n        }, this);\r\n\r\n        // this.node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n        //     this.onMouseUp(event);\r\n        // }, this);\r\n\r\n        // this.node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\r\n        //     this.onMouseUp(event);\r\n        // }, this);\r\n    },\r\n\r\n\r\n    onDisable() {\r\n        this.clear();\r\n    },\r\n\r\n    clear() {\r\n\r\n        this.unschedule(this.timeOutflow);\r\n\r\n        this.clearTile();\r\n\r\n        this.allCells.splice(0, this.allCells.length);\r\n        this.allTowers.splice(0, this.allTowers.length);\r\n        this.selectedLines.splice(0, this.selectedLines.length);\r\n        this.enemys.splice(0, this.enemys.length);\r\n        this.helplines.splice(0, this.helplines.length);\r\n        this.myRole = null;\r\n        this.helpShaked.splice(0, this.helpShaked.length);\r\n\r\n        if (this.helpPath != null && this.helpPath.length > 0) {\r\n            this.helpPath.splice(0, this.helpPath.length);\r\n        }\r\n\r\n        // Xuanyou.Util.DestroyAllChilds (tileBox);\r\n\r\n        hexTileHeight = 100;\r\n        this.mouseIsDown = false;\r\n        this.gameOver = false;\r\n        this.movesLeft = 0;\r\n        this.moved = 0;\r\n        this.turnBackCount = 0;\r\n        this.lastDirection = -1;\r\n        this.isMoving = false;\r\n\r\n        // this.filling = 0;\r\n        // this.filling_str = \"0\";\r\n        this.currentLineColor = 0;\r\n        this.oldCurrentLineColor = 0;\r\n\r\n        // this.m_Num = 0;\r\n        // this.m_tweenNum = 0;\r\n    },\r\n\r\n    clearTile() {\r\n        // cc.log(\"this.tileBox.childrenCount:\"+this.tileBox.childrenCount)\r\n        if (this.tileBox.childrenCount > 0) {\r\n            //如果有child，destroy\r\n            for (var i = 0; i < this.tileBox.childrenCount; i++) {\r\n                var n = this.tileBox.children[i];\r\n                if (n != null) {\r\n                    n.active = false;\r\n                    n.destroy();\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.iceBox.childrenCount > 0) {\r\n            //如果有child，destroy\r\n            for (var i = 0; i < this.iceBox.childrenCount; i++) {\r\n                var n = this.iceBox.children[i];\r\n                if (n != null) {\r\n                    n.active = false;\r\n                    n.destroy();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    init() {\r\n        //cc.warn(\"____________________conf/level_detail/b_\" + bid + \"/\" + mid + \"/\" + lid + \".json\");\r\n\r\n        var self = this;\r\n        this.selectedLines = [];\r\n        this.enemys = [];\r\n        this.helplines = [];\r\n        this.helpPath = [];\r\n        this.myRole = null;\r\n        this.isMoving = false;\r\n\r\n        this.endView.active = false;\r\n        this.timeIsUpNode.active = false;\r\n        this.gotMoreTime = false;\r\n        if (bid != null && bid > 0 && mid != null && mid > 0 && lid != null && lid > 0) {\r\n            var path = \"conf/level_detail/b_\" + bid + \"/\" + mid + \"/\" + lid;\r\n            this.gameApplication.getConf(path, function (results) {\r\n                this.mission = results;\r\n                this.initGame();\r\n            }.bind(this));\r\n\r\n            //预加载上下两关\r\n            var arr = [];\r\n            if (lid > 1) {\r\n                arr.push(lid - 1);\r\n            }\r\n            if (lid < 100) {\r\n                arr.push(lid + 1);\r\n            }\r\n            arr.forEach(function (tmp_lid) {\r\n                var tmp_path = \"conf/level_detail/b_\" + bid + \"/\" + mid + \"/\" + tmp_lid;\r\n                self.gameApplication.getConf(tmp_path, null);\r\n            });\r\n\r\n            //init HelpBtn\r\n            this.initHelpBtn();\r\n\r\n        } else {\r\n            this.onBackBtnClicked();\r\n        }\r\n    },\r\n\r\n    initHelpBtn() {\r\n        var self = this;\r\n        SDK().getItem(\"my_help\", function (count) {\r\n            if (count == 0) {\r\n                self.helpCount = 5;\r\n            } else if (count == -1) {\r\n                self.helpCount = 0;\r\n            } else {\r\n                self.helpCount = count;\r\n            }\r\n        }.bind(this));\r\n    },\r\n\r\n    initGame() {\r\n        var curIdx = this.judgeIdx(mid, lid);\r\n        window.lastPlay = curIdx;\r\n        this.timeIsUpNode.active = false;\r\n        this.timeIsUpEndNode.active = false;\r\n        this.gotMoreTime = false;\r\n        this.leaveSteps.active = false;\r\n        this.endView.active = false;\r\n        this.clear();\r\n\r\n        // cc.log(\"this.mission:\",this.mission)\r\n\r\n        var lines = this.mission['lines'];\r\n        var linesCount = lines.length;\r\n\r\n        this.turnBackCount = 0;\r\n        this.helpShaked.splice(0, this.helpShaked.length);\r\n\r\n        this.lastDirection = -1;\r\n\r\n\r\n        var path = \"conf/level_list/level_\" + bid + '_' + mid;\r\n        this.gameApplication.getConf(path, function (results) {\r\n            var levelInfo = results;\r\n            this.title.string = levelInfo['title'] + \" \" + lid;\r\n        }.bind(this));\r\n\r\n\r\n        // this.moves.string = \"<color=#ff0000>0</c>/\"+this.mission['moves'];\r\n        this.moves.string = \"0/\" + linesCount;\r\n\r\n\r\n\r\n        //判断是否有上一关\r\n        this.preBtn.active = false;\r\n        this.nextBtn.active = false;\r\n\r\n        //最好成绩\r\n        SDK().getItem(bid + \"_\" + mid + \"_\" + lid + \"_moves\", function (best) {\r\n            if (best <= 0) {\r\n                this.best.string = \"-\";\r\n            } else {\r\n                this.best.string = best.toString();\r\n            }\r\n        }.bind(this));\r\n\r\n\r\n        //初始化格子\r\n        var grid = cc.v2(this.mission['x'], this.mission['y']);\r\n        this.createGrid(grid, this.mission[\"walls\"], this.mission[\"ice\"], this.mission[\"tower\"], function () {\r\n\r\n            this.scheduleOnce(function () {\r\n                //初始化球的位置\r\n                this.createRole(this.mission['start'], this.mission['end']);\r\n\r\n                //初始化帮助\r\n                this.initHelpPath(Utils.cloneObj(this.mission[\"lines\"]));\r\n\r\n                var enemy = this.mission['enemy'];\r\n                if (enemy.length > 0) {\r\n                    this.createEnemy(this.mission['enemy']);\r\n                }\r\n\r\n                //初始化步数模式\r\n                if (mid == 1) {\r\n                    this.moved = 0;\r\n                    this.maxValidMoves = this.getSteps();\r\n                    this.maxValidMoves = this.maxValidMoves + 5;\r\n                    this.movesLeft = this.maxValidMoves;\r\n                    this.leaveSteps.active = true;\r\n                    this.updateUI();\r\n                }\r\n\r\n\r\n                //初始化时间模式\r\n                if (mid == 3) {\r\n                    // cc.log(\"初始化时间模式\")\r\n                    var t = 12;\r\n                    if (lid <= 5) {\r\n                        t = 12;\r\n                    } else if (lid <= 20) {\r\n                        t = 15;\r\n                    } else if (lid <= 45) {\r\n                        t = 20;\r\n                    } else if (lid <= 75) {\r\n                        t = 25;\r\n                    } else {\r\n                        t = 30;\r\n                    }\r\n\r\n                    this.timesLeft = t;\r\n                    this.timesNode.active = true;\r\n                    this.timesVal.string = t.toString()\r\n\r\n                    var interval = 1;\r\n                    var repeat = t;\r\n                    var delay = 1;\r\n\r\n                    this.schedule(this.timeOutflow, interval, repeat, delay);\r\n                } else {\r\n                    this.timesLeft = -1;\r\n                    this.timesNode.active = false;\r\n                }\r\n            }.bind(this), 0.5)\r\n        }.bind(this));\r\n    },\r\n\r\n    initHelpPath(helpPath) {\r\n        //cc.log(\"initHelpPath:\",helpPath);\r\n        // this.helpPath = helpPath;\r\n        // cc.log(\"+++++++++++==mid:\",mid)\r\n        if (mid != 2 && mid != 4 && mid != 6) {\r\n            this.helpPath = helpPath;\r\n            //cc.log(\"______\", this.helpPath)\r\n        } else {\r\n            //cc.log(\"_______________\")\r\n            this.helpPath = [];\r\n            this.helpPath.push(this.myRole.axialCoordinate);\r\n\r\n            var test = 0;\r\n            while (helpPath.length > 0) {\r\n                for (var i = 0; i < helpPath.length; i++) {\r\n                    var path = helpPath[i];\r\n                    // cc.log(\"_____check:\",path);\r\n\r\n                    if (path != null) {\r\n                        path = this.checkXY(path, 0, 0);\r\n                        var canMovePath = this.checkMovePos(path);\r\n                        // cc.log(\"canMovePath:\",canMovePath);\r\n                        // cc.log(\"this.helpPath[this.helpPath.length-1]:\",this.helpPath[this.helpPath.length-1]);\r\n                        for (var j = 0; j < canMovePath.length; j++) {\r\n\r\n                            var testV2 = this.helpPath[this.helpPath.length - 1];\r\n                            if (canMovePath[j].x == testV2.x && canMovePath[j].y == testV2.y) {\r\n                                this.helpPath.push(helpPath[i]);\r\n                                helpPath.splice(i, 1)\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n\r\n                }\r\n                test++;\r\n\r\n\r\n                if (test >= 500) {\r\n                    // cc.log(\"helpPath:\",JSON.stringify(helpPath));\r\n                    helpPath.splice(0, helpPath.length);\r\n                    helpPath = [];\r\n                }\r\n            }\r\n        }\r\n\r\n        this.stepsLines = this.helpPath;\r\n\r\n        // cc.log(\"____________this.helpPath:\",this.helpPath);\r\n\r\n\r\n    },\r\n\r\n    timeOutflow() {\r\n        //时间模式\r\n        // cc.log(\"时间模式:\",this.timesLeft)\r\n        var self = this;\r\n        if (this.timesLeft > 0) {\r\n            this.timesLeft--;\r\n            if (this.timesLeft < 10 && this.timesLeft > 1) {\r\n                this.schedule(function () {\r\n                    self.gameApplication.soundManager.playSound(\"clock\");\r\n                }, 0.5, 2, 0);\r\n            }\r\n\r\n            this.timesNode.active = true;\r\n            this.timesVal.string = this.timesLeft.toString();\r\n            if (this.timesLeft < 10) {\r\n                this.timesVal.node.color = cc.hexToColor(\"#ef3a40\");\r\n            } else {\r\n                this.timesVal.node.color = cc.hexToColor(\"#ffffff\");\r\n            }\r\n\r\n            if (this.timesLeft == 0) {\r\n                this.gameOver = true;\r\n\r\n                if (this.gotMoreTime) {\r\n                    this.timeIsUpNode.active = false;\r\n                    this.timeIsUpEndNode.active = true;\r\n                } else {\r\n\r\n                    if (SDK().hasVideoAd() || true) {\r\n                        // console.log(\"_______________1\")\r\n                        this.timeIsUpNode.active = true;\r\n                    }\r\n                    this.timeIsUpEndNode.active = false;\r\n                }\r\n\r\n                this.stopAllAction();\r\n            }\r\n        }\r\n    },\r\n\r\n    getMoreTime(event, type) {\r\n        event.target.getComponent(cc.Button).interactable = false;\r\n        //看视频\r\n        if (type == 1) {\r\n            window.gameApplication.onVideoBtnClick(function (isCompleted) {\r\n                if (isCompleted) {\r\n                    this.addTime();\r\n                    this.timeIsUpNode.active = false;\r\n                }\r\n                event.target.getComponent(cc.Button).interactable = true;\r\n            }.bind(this), false);\r\n        }\r\n        //用金币\r\n        else if (type == 2) {\r\n            SDK().getItem(\"coins\", function (coin) {\r\n                if (coin >= 100) {\r\n                    coin = coin - 100;\r\n                    SDK().setItem({ coins: coin })\r\n                    this.addTime();\r\n\r\n                } else {\r\n                    window.gameApplication.showCoinView(function (isCompleted) {\r\n                        if (isCompleted) {\r\n                            this.addTime();\r\n                        }\r\n                    }.bind(this), false)\r\n                }\r\n                event.target.getComponent(cc.Button).interactable = true;\r\n            }.bind(this))\r\n        }\r\n    },\r\n\r\n    addTime() {\r\n        this.timesLeft = 10;\r\n        this.timesNode.active = true;\r\n        this.timesVal.string = \"10\"\r\n\r\n        var interval = 1;\r\n        var repeat = 10;\r\n        var delay = 1;\r\n\r\n        this.timeIsUpNode.active = false;\r\n        this.gotMoreTime = true;\r\n        this.gameOver = false;\r\n        this.unschedule(this.timeOutflow);\r\n        this.schedule(this.timeOutflow, interval, repeat, delay);\r\n    },\r\n\r\n    getMoreTimeInv(event) {\r\n        var self = this;\r\n        SDK().getItem(\"all\", function (score) {\r\n            SDK().share(score, function (isCompleted) {\r\n                if (isCompleted) {\r\n                    self.timesLeft = 10;\r\n                    self.timesNode.active = true;\r\n                    self.timesVal.string = \"10\"\r\n\r\n                    var interval = 1;\r\n                    var repeat = 10;\r\n                    var delay = 1;\r\n\r\n                    self.gotMoreTime = true;\r\n                    self.gameOver = false;\r\n                    self.unschedule(this.timeOutflow);\r\n                    self.schedule(self.timeOutflow, interval, repeat, delay);\r\n                } else {\r\n                    self.showInvAgain(3, event);\r\n                }\r\n                event.target.getComponent(cc.Button).interactable = true;\r\n            }.bind(this));\r\n        }.bind(this));\r\n    },\r\n\r\n\r\n\r\n    restarGame(delay) {\r\n        this.myRole.node.stopAllActions();\r\n        this.unschedule(this.timeOutflow);\r\n        this.timesVal.node.color = cc.hexToColor(\"#ffffff\");\r\n\r\n        this.timeIsUpNode.active = false;\r\n        this.gotMoreTime = false;\r\n        this.endView.active = false;\r\n        this.selectedLines.splice(0, this.selectedLines.length);\r\n        this.enemys.splice(0, this.enemys.length);\r\n        this.helplines.splice(0, this.helplines.length);\r\n        this.helpPath.splice(0, this.helpPath.length);\r\n        this.helpShaked.splice(0, this.helpShaked.length);\r\n        this.isMoving = false;\r\n\r\n\r\n        //清除当前数据\r\n        this.movesLeft = this.maxValidMoves;\r\n        this.moved = 0;\r\n        this.turnBackCount = 0;\r\n\r\n        this.lastDirection = -1;\r\n\r\n        if (delay != null && delay > 0) {\r\n            this.scheduleOnce(function () {\r\n                this.gameOver = false;\r\n                this.myRole = null;\r\n                this.initGame();\r\n            }, delay)\r\n        } else {\r\n            this.gameOver = false;\r\n            this.myRole = null;\r\n            this.initGame();\r\n        }\r\n    },\r\n\r\n    //获取步数\r\n    getSteps() {\r\n        var lines = [];\r\n        var helpStart = null;\r\n        var helpIdx = 0;\r\n        if (helpStart == null) {\r\n            helpStart = this.checkXY(this.stepsLines[0], 0, 0);\r\n            helpIdx = 0;\r\n        }\r\n\r\n        lines.push(cc.v2(helpStart.x, helpStart.y));\r\n\r\n        //获得路线\r\n        var stepCount = 1;\r\n\r\n        while (helpIdx < this.stepsLines.length) {\r\n            var isContinue = true;\r\n            while (helpIdx < this.stepsLines.length && isContinue) {\r\n                helpStart = this.checkXY(this.stepsLines[helpIdx], 0, 0);\r\n                lines.push(cc.v2(helpStart.x, helpStart.y));\r\n                var hc = this.getCellByCoordinate(helpStart);\r\n                if (hc) {\r\n                    var canMove = this.checkCanMoveCount(this.checkMove(helpStart));\r\n                    if (canMove > 2 && lines.length > 1) {\r\n                        isContinue = false;\r\n                        stepCount++;\r\n                    }\r\n                }\r\n                helpIdx++;\r\n            }\r\n        }\r\n\r\n        //console.log(stepCount);\r\n        return stepCount;\r\n    },\r\n\r\n    help() {\r\n        if (this.gameOver || this.myRole == null) {\r\n            return;\r\n        }\r\n        //判断已走的路径有没有途径点（找到起点）\r\n        if (this.helpPath.length <= 0) {\r\n            return;\r\n        }\r\n\r\n        var helpStart = null;\r\n        var helpIdx = 0;\r\n        if (this.selectedLines.length > 0) {\r\n            for (var i = this.helpPath.length - 1; i >= 0; i--) {\r\n                var tmpPath = this.checkXY(this.helpPath[i], 0, 0);\r\n                var path = cc.v2(tmpPath.x, tmpPath.y);\r\n                for (var j = this.selectedLines.length - 1; j >= 0; j--) {\r\n                    var selected = this.selectedLines[j];\r\n                    if (helpStart == null && path.equals(selected)) {\r\n                        helpStart = path;\r\n                        helpIdx = i;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // cc.log(\"helpStart:\",helpStart)\r\n        if (helpStart == null) {\r\n            helpStart = this.checkXY(this.helpPath[0], 0, 0);\r\n            helpIdx = 0;\r\n        }\r\n        // cc.log(\"helpStart:\",helpStart)\r\n\r\n        this.showHelpLine(helpStart, helpIdx);\r\n    },\r\n\r\n\r\n    showHelpLine(helpStart, helpIdx) {\r\n        if (this.helpPath.length <= 0) {\r\n            return;\r\n        }\r\n        // cc.log(\"helpIdx:\",helpIdx);\r\n\r\n        var self = this;\r\n\r\n        var startV2 = cc.v2(helpStart.x, helpStart.y);\r\n        // cc.log(\"startV2:\",startV2);\r\n        if (this.helplines.length > 0) {\r\n            startV2 = this.helplines[this.helplines.length - 1];\r\n        }\r\n\r\n        //如果startV2已经在heleLines里了，那么从helpLines最后一个节点开始\r\n        // for(var i = this.helpPath.length-1;i >= 0;i--){\r\n        for (var i = 0; i < this.helpPath.length; i++) {\r\n            var v2 = this.helpPath[i];\r\n            // cc.log(\"__v2:\",v2)\r\n            if (startV2.equals(v2)) {\r\n                startV2 = cc.v2(v2.x, v2.y);\r\n                helpIdx = i;\r\n                // cc.log(\"edit_startV2:\",startV2);\r\n                // cc.log(\"__helpIdx:\",helpIdx);\r\n                break;\r\n            }\r\n        }\r\n        // cc.log(\"this.helpPath.length-1:\",this.helpPath.length-1)\r\n        if (helpIdx < this.helpPath.length - 1) {\r\n            this.helpCount--;\r\n        }\r\n\r\n\r\n        // var helplines = [];\r\n\r\n        if (this.helplines.length <= 0) {\r\n            if (!startV2.equals(this.myRole.axialCoordinate) && Utils.isNeighbors(startV2, this.myRole.axialCoordinate)) {\r\n                self.helplines.push(cc.v2(this.myRole.axialCoordinate.x, this.myRole.axialCoordinate.y));\r\n            }\r\n            self.helplines.push(cc.v2(startV2.x, startV2.y));\r\n            // cc.log(\"__self.helplines:\",self.helplines);\r\n        }\r\n\r\n        //获得路线\r\n        var isContinue = true;\r\n        while (++helpIdx < this.helpPath.length && isContinue) {\r\n            helpStart = this.checkXY(this.helpPath[helpIdx], 0, 0);\r\n            self.helplines.push(cc.v2(helpStart.x, helpStart.y));\r\n            var hc = self.getCellByCoordinate(helpStart);\r\n            //console.log(\"helpStart:\", helpStart);\r\n            //console.log(\"hc:\", hc);\r\n            if (hc) {\r\n                var canMove = this.checkCanMoveCount(this.checkMove(helpStart));\r\n                if (canMove > 2 && self.helplines.length > 1 && !hc.isIce && self.helplines.length > self.selectedLines.length) {\r\n                    isContinue = false;\r\n                }\r\n            }\r\n        }\r\n\r\n        // cc.log(\"self.helplines:\",self.helplines);\r\n        //绘制路线\r\n        if (self.helplines.length > 1) {\r\n\r\n            // for(var i = 0;i < this.allCells.length;i++){\r\n            //     var hc = this.allCells[i];\r\n            //     hc.hideHelpLine();\r\n            // }\r\n\r\n            for (var i = 0; i < self.helplines.length; i++) {\r\n                var tmp_coordinate = self.helplines[i];\r\n                var hc = self.getCellByCoordinate(tmp_coordinate);\r\n                if (hc) {\r\n                    if (i == 0) {\r\n                        hc.showStartHelp(self.helplines[i + 1]);\r\n                    } else if (i == self.helplines.length - 1) {\r\n                        hc.showEndHelp(self.helplines[self.helplines.length - 2]);\r\n                    } else {\r\n                        hc.showHelp(self.helplines[i - 1], self.helplines[i + 1]);\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n\r\n        // cc.log(\"self.helplines:\",self.helplines);\r\n\r\n    },\r\n\r\n\r\n    update(dt) {\r\n        if (this.gameOver) {\r\n            return;//stop game\r\n        }\r\n        // cc.log(\"this.enemys.length:\",this.enemys.length)\r\n        if (this.enemys.length > 0) {\r\n\r\n            //移动\r\n            for (var i = 0; i < this.enemys.length; i++) {\r\n                var enemy = this.enemys[i];\r\n                this.roundMove(enemy);\r\n            }\r\n        }\r\n\r\n        //炮塔发射子弹\r\n        if (this.allTowers.length > 0) {\r\n            for (var i = 0; i < this.allTowers.length; i++) {\r\n                var tower = this.allTowers[i];\r\n                this.towerShoot(tower);\r\n            }\r\n        }\r\n\r\n\r\n    },\r\n\r\n    //炮塔发射子弹\r\n    towerShoot(tower) {\r\n        if (!tower.isShooting) {\r\n            tower.isShooting = true;\r\n            tower.bubble.active = true;\r\n            var canMove = this.checkMove(tower.bubbleAxialCoordinate);\r\n\r\n            var direction = -1;\r\n            if ((tower.direction != -1 && canMove[tower.direction])) {\r\n                direction = tower.direction;\r\n            }\r\n\r\n            if (direction == -1) {\r\n                // cc.log(\"打到墙了，再往前移动半个格子\",canMove,tower)\r\n                // var movePlus = this.movePlus[tower.direction];\r\n                // var hcPos = cc.pCompMult(cc.v2(0.2,0.2),cc.pCompMult(cc.v2(hexTileHeight,hexTileHeight),movePlus));\r\n                // var a1 = cc.moveBy(tower['s']*0.3*0.3,hcPos.x ,hcPos.y);\r\n                //cb\r\n                var cb1 = cc.callFunc(function () {\r\n                    //播放炸开动画\r\n                    tower.bubble.getComponent(\"NormalAnimation\").play();\r\n                }, this);\r\n                var delay0 = cc.delayTime(1.0);\r\n\r\n                var cb2 = cc.callFunc(function () {\r\n                    //重置\r\n                    tower.bubbleAxialCoordinate = tower.axialCoordinate;\r\n                    tower.bubble.position = cc.pCompMult(tower.node.getPosition(), cc.v2(0.5, 0.5));\r\n                    tower.bubble.opacity = 0;\r\n                }, this);\r\n                //TODO，等待多少秒后，再次发射\r\n                var delay = cc.delayTime(tower['delay']);\r\n                var cb4 = cc.callFunc(function () {\r\n                    //重置\r\n                    tower.isShooting = false;\r\n                    tower.bubble.opacity = 255;\r\n                }, this);\r\n\r\n                var seq = cc.sequence(cb1, delay0, cb2, delay, cb4);\r\n                tower.bubble.runAction(seq);\r\n            } else {\r\n                // cc.log(\"hexTileHeight:\",hexTileHeight)\r\n                // var scale = hexTileHeight;\r\n                var scale = hexTileHeight / 100;\r\n\r\n                var nextPos = tower.bubbleAxialCoordinate.add(this.movePlus[direction]);\r\n                var hc = this.getCellByCoordinate(nextPos);\r\n\r\n                // cc.log(\"nextPos\",nextPos);\r\n                // var hcPos = tower.bubble.getPosition();\r\n                // var movePlus = this.movePlus[direction];\r\n                // hcPos = hcPos.add(cc.pCompMult(cc.v2(hexTileHeight,hexTileHeight),nextPos));\r\n                //  cc.log(\"_______movePlus:\",cc.pCompMult(cc.v2(hexTileHeight,hexTileHeight),movePlus))\r\n\r\n                // var hcPos = cc.pCompMult(cc.v2(hexTileHeight,hexTileHeight),this.movePlus[direction]);\r\n                // var hcPos = tower.bubble.convertToNodeSpaceAR(worldPosition);\r\n\r\n                let worldPosition = this.tileBox.convertToWorldSpaceAR(hc.node.getPosition());\r\n                var hcPos_tmp = tower.node.convertToNodeSpaceAR(worldPosition);\r\n\r\n                var hcPos;\r\n                // hcPos = hc.node.convertToWorldSpaceAR(hcPos)\r\n                // hcPos = tower.bubble.convertToNodeSpaceAR(hcPos);\r\n                // cc.log(\"++++++++++++worldPosition:\",worldPosition)\r\n                // cc.log(\"++++++++++++hcPos:\",hcPos)\r\n                // cc.log(\"direction:\",direction)\r\n\r\n                if (direction == 1) {\r\n                    hcPos = cc.v2(hcPos_tmp.y * -1, hcPos_tmp.x * -1);\r\n                } else if (direction == 2) {\r\n                    hcPos = cc.v2(hcPos_tmp.x * -1, hcPos_tmp.y * -1);\r\n                } else if (direction == 3) {\r\n                    hcPos = cc.v2(hcPos_tmp.y, hcPos_tmp.x);\r\n                } else {\r\n                    hcPos = cc.v2(hcPos_tmp.x, hcPos_tmp.y);\r\n                }\r\n\r\n                var a1 = cc.moveTo(tower['s'] * 0.3, hcPos.y, hcPos.x);\r\n                //cb\r\n                var cb1 = cc.callFunc(function () {\r\n                    //更新位置\r\n                    tower.bubbleAxialCoordinate = nextPos;\r\n                    tower.isShooting = false;\r\n                }, this);\r\n\r\n                var seq = cc.sequence(a1, cb1);\r\n                tower.bubble.runAction(seq);\r\n\r\n            }\r\n        }\r\n    },\r\n\r\n    //怪物自动移动\r\n    roundMove(enemy) {\r\n        if (!enemy.isMoving) {\r\n            enemy.isMoving = true;\r\n            var canMove = this.checkMove(enemy.axialCoordinate);\r\n\r\n            var direction = -1;\r\n\r\n            if ((enemy.direction != -1 && canMove[enemy.direction] && this.checkMoveDirectionCount(canMove, enemy.direction) == 1) || (enemy.direction != -1 && canMove[enemy.direction] && Math.random() > 0.6)) {\r\n                direction = enemy.direction;\r\n            } else {\r\n                while (direction == -1) {\r\n                    var idx = Utils.GetRandomNum(0, 3);\r\n                    if (canMove[idx]) {\r\n                        direction = idx;\r\n                    }\r\n                }\r\n            }\r\n\r\n            enemy.direction = direction;\r\n\r\n            var nextPos = enemy.axialCoordinate.add(this.movePlus[direction]);\r\n            var hc = this.getCellByCoordinate(nextPos);\r\n\r\n            var hcPos = hc.node.getPosition();\r\n            var a1 = cc.moveTo(1, hcPos.x, hcPos.y);\r\n            //cb\r\n            var cb1 = cc.callFunc(function () {\r\n\r\n                //更新位置\r\n                enemy.axialCoordinate = nextPos;\r\n                enemy.isMoving = false;\r\n            }, this);\r\n\r\n            var seq = cc.sequence(a1, cb1);\r\n            enemy.node.runAction(seq);\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n     * 当屏幕点击\r\n    */\r\n    onMouseDown(event) {\r\n        if (this.gameOver || this.myRole == null) {\r\n            return;\r\n        }\r\n        this.mouseIsDown = true;\r\n        this.touchPos = this.tileBox.convertToNodeSpaceAR(event.getLocation());\r\n    },\r\n\r\n    onMouseMove(event) {\r\n        if (this.gameOver || this.myRole == null) {\r\n            return;\r\n        }\r\n        if (this.mouseIsDown) {\r\n            var movePos = this.tileBox.convertToNodeSpaceAR(event.getLocation());\r\n\r\n            var offsetX = movePos.x - this.touchPos.x;\r\n            var offsetY = movePos.y - this.touchPos.y;\r\n\r\n            if (Math.abs(offsetX) < 30 && Math.abs(offsetY) < 30) {\r\n                return;\r\n            }\r\n\r\n            //根据X方向与Y方向的偏移量大小的判断  \r\n            if (Math.abs(offsetX) > Math.abs(offsetY)) {\r\n                if (offsetX < 0) {\r\n                    // cc.log(\"左\")\r\n                    this.doAction(1, true);   //左\r\n                }\r\n                else {\r\n                    // cc.log(\"右\")\r\n                    this.doAction(3, true);   //右边\r\n                }\r\n            }\r\n            else {\r\n                if (offsetY > 0) {\r\n                    this.doAction(0, true);   //上\r\n                }\r\n                else {\r\n                    this.doAction(2, true);//下\r\n                }\r\n            }\r\n\r\n            this.mouseIsDown = false;\r\n        }\r\n    },\r\n\r\n\r\n    getCellByCoordinate(_coordinate) {\r\n        for (var i = 0; i < this.allCells.length; i++) {\r\n            var hc = this.allCells[i];\r\n            if (hc.axialCoordinate.equals(_coordinate)) {\r\n                return hc;\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n\r\n    stopAllAction() {\r\n        cc.log(\"stopAllAction\")\r\n    },\r\n\r\n    die() {\r\n        this.unschedule(this.timeOutflow);\r\n        this.gameOver = true;\r\n        //播放死亡动画\r\n        this.myRole.playDie();\r\n        this.gameApplication.soundManager.playSound(\"error\");\r\n        this.scheduleOnce(function () {\r\n            this.gameApplication.openMainView();\r\n        }.bind(this), 1)\r\n    },\r\n\r\n    showGameOver() {\r\n\r\n        //预加载下一关\r\n        if (bid != null && bid > 0 && mid != null && mid > 0 && lid != null && lid > 0) {\r\n            var arr = [];\r\n            if (lid < 100) {\r\n                arr.push(lid + 1);\r\n            }\r\n            arr.forEach(function (tmp_lid) {\r\n                var tmp_path = \"conf/level_detail/b_\" + bid + \"/\" + mid + \"/\" + tmp_lid;\r\n                window.gameApplication.getConf(tmp_path, null);\r\n            });\r\n        }\r\n\r\n        this.gameApplication.soundManager.playSound(\"gamewin\");\r\n\r\n        this.unschedule(this.timeOutflow);\r\n        this.timeIsUpNode.active = false;\r\n\r\n        // cc.log(\"_______________showGameOver\");\r\n        var self = this;\r\n        this.gameOver = true;\r\n        this.endView.active = true;\r\n\r\n        this.stopAllAction();\r\n\r\n        var curr_star = 0;\r\n\r\n        if (this.turnBackCount <= 0) {\r\n            curr_star = 3;\r\n        } else if (this.turnBackCount <= 6) {\r\n            curr_star = 2;\r\n        } else {\r\n            curr_star = 1;\r\n        }\r\n\r\n        if (curr_star == 3) {\r\n            this.endView_title.string = \"GREAT\";\r\n        } else if (curr_star == 2) {\r\n            this.endView_title.string = \"GOOD\";\r\n        } else {\r\n            this.endView_title.string = \"CLEAR\";\r\n        }\r\n        this.endView_title.string = \"COMPLETED\";\r\n\r\n        this.endView_text.string = \"You finish with \" + this.moved + \" moves\";\r\n        this.giftBtn.active = true;\r\n\r\n\r\n        //最好成绩\r\n        SDK().getItem(bid + \"_\" + mid + \"_\" + lid, function (star) {\r\n            //console.log(bid + \"_\" + mid + \"_\" + lid)\r\n            //设置最后玩的关卡\r\n            SDK().getItem(\"curIdx\", function (idx) {\r\n                var curIdx = this.judgeIdx(mid, lid);\r\n                //console.log(curIdx)\r\n                if (curIdx + 1 > idx) {\r\n                    var param = {};\r\n                    window.curIdx = curIdx + 1;\r\n                    param.curIdx = window.curIdx;\r\n                    SDK().setItem(param, function () {\r\n                        window.mainScirpt.initStage(window.curIdx);\r\n                    }.bind(this));\r\n                }\r\n            }.bind(this))\r\n\r\n            //如果当前星星大于历史最高，那么保存\r\n            if (star < 1) {\r\n                var param = {};\r\n                param[bid + \"_\" + mid + \"_\" + lid] = 1;\r\n                var saveCount = 0;\r\n                SDK().setItem(param, function () {\r\n                    saveCount++;\r\n                    if (saveCount >= 2) {\r\n                        this.scheduleOnce(function () {\r\n                            this.endView.active = false;\r\n                            var curIdx = this.judgeIdx(mid, lid);\r\n                            window.mainScirpt.initStage(curIdx);\r\n                            this.gameApplication.openMainView(true);\r\n                            if (curIdx % 10 == 0 && curIdx != 0) {\r\n                                window.timeGiftScript.showTimeGiftView(2);\r\n                            }\r\n                        }.bind(this), 1)\r\n                    }\r\n                }.bind(this));\r\n\r\n                //保存个人星星\r\n                var plusStar = curr_star - star;\r\n                SDK().getItem(\"all\", function (score) {\r\n                    score += 1;\r\n                    SDK().setRankScore(2, score, \"{}\", null);\r\n                    SDK().setItem({ all: score }, function () {\r\n                        saveCount++;\r\n                        if (saveCount >= 2) {\r\n                            this.scheduleOnce(function () {\r\n                                this.endView.active = false;\r\n                                var curIdx = this.judgeIdx(mid, lid);\r\n                                window.mainScirpt.initStage(curIdx);\r\n                                this.gameApplication.openMainView(true);\r\n                                if (curIdx % 10 == 0 && curIdx != 0) {\r\n                                    window.timeGiftScript.showTimeGiftView(2);\r\n                                }\r\n                            }.bind(this), 1)\r\n                        }\r\n                    }.bind(this));\r\n                }.bind(this));\r\n\r\n                //保存mid关卡的星星\r\n                SDK().getItem(bid + \"_\" + mid, function (score) {\r\n                    score += 1;\r\n                    var param = {};\r\n                    param[bid + \"_\" + mid] = score;\r\n                    SDK().setItem(param, null);\r\n                }.bind(this));\r\n            } else {\r\n                this.scheduleOnce(function () {\r\n                    this.endView.active = false;\r\n                    this.gameApplication.openMainView();\r\n                }.bind(this), 1)\r\n            }\r\n        }.bind(this));\r\n\r\n\r\n        SDK().getItem(bid + \"_\" + mid + \"_\" + lid + \"_moves\", function (best) {\r\n            if (self.moved < best || best <= 0) {\r\n                //保存历史最小步数\r\n                var param = {};\r\n                param[bid + \"_\" + mid + \"_\" + lid + \"_moves\"] = self.moved;\r\n                SDK().setItem(param, null);\r\n            }\r\n        }.bind(this));\r\n\r\n        this.gameApplication.playTimes++;\r\n    },\r\n\r\n    //判断所在关卡\r\n    judgeIdx(mid, lid) {\r\n        var idx = 0;\r\n        if (lid >= 50) {\r\n            lid = lid - 50;\r\n            idx = 300;\r\n            idx = idx + ((mid - 1) * 10) + (Math.floor((lid - 1) / 10) * 50) + lid % 10;\r\n        } else {\r\n            idx = ((mid - 1) * 10) + (Math.floor((lid - 1) / 10) * 60) + (lid - 1) % 10;\r\n        }\r\n        return idx;\r\n    },\r\n\r\n    onOpAdClicked() {\r\n        if (this.opad_game_id != null) {\r\n            SDK().switchGameAsync(this.opad_game_id);\r\n        }\r\n        // SDK().onOpAdBtnClicked();\r\n    },\r\n\r\n\r\n    checkWin() {\r\n        var isWin = this.myRole.axialCoordinate.equals(this.endObj.axialCoordinate);\r\n        if (isWin) {\r\n            // cc.log(\"到达终点，游戏结束\");\r\n            this.showGameOver();\r\n        }\r\n        return isWin;\r\n    },\r\n\r\n    moveEnd() {\r\n        this.isMoving = false;\r\n\r\n\r\n        //检查胜利\r\n        if (!this.checkWin()) {\r\n            var canMove = this.checkMove();\r\n            this.gameApplication.soundManager.playSound(\"done\");\r\n\r\n            //检查当前是否在冰上，并且前方可以走\r\n            var hc = this.getCellByCoordinate(this.myRole.axialCoordinate);\r\n            if (hc.isIce && canMove[this.lastDirection]) {\r\n                //继续行走\r\n                this.doAction(this.lastDirection, true);\r\n            } else {\r\n                //检查箭头\r\n                this.moved++;\r\n                this.movesLeft--;\r\n                if (this.turnBackCount > 0 && this.turnBackCount % 2 == 0 && !Utils.inArray(this.turnBackCount, this.helpShaked)) {\r\n                    this.helpBtnShake();\r\n                    this.helpShaked.push(this.turnBackCount);\r\n                }\r\n                this.myRole.setArrow(canMove[0], canMove[1], canMove[2], canMove[3]);\r\n            }\r\n        }\r\n\r\n        this.updateUI();\r\n    },\r\n\r\n    addSelectedLines(coordinate) {\r\n        var self = this;\r\n        if (this.selectedLines.length >= 2 && coordinate.equals(this.selectedLines[this.selectedLines.length - 2])) {\r\n            var tmp_coordinate = this.selectedLines.pop();\r\n            var hc = this.getCellByCoordinate(tmp_coordinate);\r\n            hc.hideLine();\r\n\r\n        } else {\r\n            this.selectedLines.push(cc.v2(coordinate.x, coordinate.y));\r\n        }\r\n\r\n        if (this.selectedLines.length > 1) {\r\n\r\n            this.scheduleOnce(function () {\r\n                //绘制路线\r\n                for (var i = 0; i <= self.selectedLines.length - 1; i++) {\r\n                    var tmp_coordinate = self.selectedLines[i];\r\n                    var hc = self.getCellByCoordinate(tmp_coordinate);\r\n                    hc.hideLine();\r\n                }\r\n                for (var i = 0; i <= self.selectedLines.length - 1; i++) {\r\n                    var tmp_coordinate = self.selectedLines[i];\r\n                    var hc = self.getCellByCoordinate(tmp_coordinate);\r\n                    if (i == 0) {\r\n                        hc.showStartLine(self.selectedLines[i + 1]);\r\n                    } else if (i == self.selectedLines.length - 1) {\r\n                        hc.showEndLine(self.selectedLines[self.selectedLines.length - 2]);\r\n                    } else {\r\n                        hc.showLine(self.selectedLines[i - 1], self.selectedLines[i + 1]);\r\n                    }\r\n                }\r\n            }, 0.08)\r\n\r\n\r\n        }\r\n\r\n    },\r\n\r\n    //移动\r\n    doAction(direction, manual) {\r\n        if (this.isMoving || this.gameOver) {\r\n            return;\r\n        }\r\n\r\n        this.isMoving = true;\r\n        this.myRole.hideArrow();\r\n        var self = this;\r\n        var canMove = this.checkMove();\r\n\r\n        if (!manual && this.checkMoveDirectionCount(canMove, direction) > 1) {\r\n            //遇到路口停止\r\n            // cc.log(\"遇到路口停止\",this.checkMoveDirectionCount(canMove,direction))\r\n            this.moveEnd();\r\n            return;\r\n        }\r\n\r\n        if (canMove[direction]) {\r\n            var nextPos = this.myRole.axialCoordinate.add(this.movePlus[direction]);\r\n            var hc = this.getCellByCoordinate(nextPos);\r\n\r\n            // cc.log(\"可以移动到\",nextPos)\r\n            if (hc != null) {\r\n\r\n                //检查是否走回头路\r\n                var isTurnBack = false;\r\n                if (direction == 0) {\r\n\r\n                    isTurnBack = this.lastDirection == 2;\r\n                } else if (direction == 3) {\r\n                    isTurnBack = this.lastDirection == 1;\r\n                } else if (direction == 1) {\r\n\r\n                    isTurnBack = this.lastDirection == 3;\r\n                } else {\r\n                    isTurnBack = this.lastDirection == 0;\r\n                }\r\n                if (isTurnBack) {\r\n                    this.turnBackCount++;\r\n                }\r\n\r\n\r\n                this.lastDirection = direction;\r\n\r\n                var hcPos = hc.node.getPosition();\r\n                var a1 = cc.moveTo(0.12, hcPos.x, hcPos.y);\r\n                //cb\r\n                var cb1 = cc.callFunc(function () {\r\n\r\n                    //更新位置\r\n                    self.myRole.axialCoordinate = nextPos;\r\n                    self.isMoving = false;\r\n                    if (!self.checkWin()) {\r\n                        self.doAction(direction, false);\r\n                    }\r\n                }, this);\r\n\r\n                //路线\r\n                this.addSelectedLines(nextPos);\r\n\r\n                var seq = cc.sequence(a1, cb1);\r\n                self.myRole.node.runAction(seq);\r\n            }\r\n\r\n        } else {\r\n            this.gameApplication.soundManager.playSound(\"done\");\r\n\r\n            if (this.checkMoveDirectionCount(canMove, direction) == 1) {\r\n                direction = this.getkMoveDirection(canMove, direction);\r\n                // cc.log(\"遇到路口，但只有一个路径。改变路径：\",direction)   \r\n                if (!this.checkWin()) {\r\n                    var hc = this.getCellByCoordinate(this.myRole.axialCoordinate);\r\n                    if (!hc.isIce) {\r\n                        this.isMoving = false;\r\n                        self.doAction(direction, true);\r\n                    } else {\r\n                        this.moveEnd();\r\n                    }\r\n                }\r\n            } else {\r\n                // cc.log(\"不能移动\",direction)    \r\n                this.moveEnd();\r\n            }\r\n        }\r\n    },\r\n\r\n    //获取唯一可以移动的路径\r\n    getkMoveDirection(canMove, direction) {\r\n        var c;\r\n        //t,l,d,r\r\n        if (direction == 0) {\r\n            c = 2;\r\n        } else if (direction == 3) {\r\n            c = 1;\r\n        } else if (direction == 1) {\r\n            c = 3;\r\n        } else {\r\n            c = 0;\r\n        }\r\n        var count = 0;\r\n        for (var i = 0; i < canMove.length; i++) {\r\n            var v = canMove[i];\r\n            if (v && i != c)\r\n                return i;\r\n        };\r\n    },\r\n\r\n    checkCanMoveCount(canMove) {\r\n        var c;\r\n        var count = 0;\r\n        for (var i = 0; i < canMove.length; i++) {\r\n            var v = canMove[i];\r\n            if (v)\r\n                count++;\r\n        };\r\n        return count;\r\n    },\r\n\r\n\r\n    //获取可以移动的方向，不算direction的反方向\r\n    checkMoveDirectionCount(canMove, direction) {\r\n        var c;\r\n        //t,l,d,r\r\n        if (direction == 0) {\r\n            c = 2;\r\n        } else if (direction == 3) {\r\n            c = 1;\r\n        } else if (direction == 1) {\r\n            c = 3;\r\n        } else {\r\n            c = 0;\r\n        }\r\n        var count = 0;\r\n        for (var i = 0; i < canMove.length; i++) {\r\n            var v = canMove[i];\r\n            if (v && i != c)\r\n                count++;\r\n        };\r\n        return count;\r\n    },\r\n\r\n    //检查可以移动的方向\r\n    checkMove(axialCoordinate) {\r\n        if (axialCoordinate == null) {\r\n            axialCoordinate = this.myRole.axialCoordinate;\r\n        }\r\n\r\n        var neighbors = Utils.getNeighborsOBJ(axialCoordinate);\r\n        var t = true, l = true, d = true, r = true;\r\n\r\n        var hc = this.getCellByCoordinate(axialCoordinate);\r\n        if (hc != null) {\r\n            if (hc.leftActive) {\r\n                l = false;\r\n            }\r\n            if (hc.rightActive) {\r\n                r = false;\r\n            }\r\n            if (hc.topActive) {\r\n                t = false;\r\n            }\r\n            if (hc.bottomActive) {\r\n                d = false;\r\n            }\r\n        }\r\n\r\n        if (t) {\r\n            var tc = this.getCellByCoordinate(neighbors.t);\r\n            if (tc != null && tc.bottomActive) {\r\n                t = false;\r\n            }\r\n        }\r\n\r\n        if (d) {\r\n            var dc = this.getCellByCoordinate(neighbors.b);\r\n            if (dc != null && dc.topActive) {\r\n                d = false;\r\n            }\r\n        }\r\n\r\n        if (l) {\r\n            var lc = this.getCellByCoordinate(neighbors.l);\r\n            if (lc != null && lc.rightActive) {\r\n                l = false;\r\n            }\r\n        }\r\n\r\n        if (r) {\r\n            var rc = this.getCellByCoordinate(neighbors.r);\r\n            if (rc != null && rc.leftActive) {\r\n                r = false;\r\n            }\r\n        }\r\n\r\n        return [t, l, d, r]\r\n\r\n\r\n    },\r\n\r\n    checkMovePos(axialCoordinate) {\r\n        if (axialCoordinate == null) {\r\n            axialCoordinate = this.myRole.axialCoordinate;\r\n        }\r\n\r\n        var neighbors = Utils.getNeighborsOBJ(axialCoordinate);\r\n        var t = neighbors.t, l = neighbors.l, d = neighbors.b, r = neighbors.r;\r\n\r\n        var hc = this.getCellByCoordinate(axialCoordinate);\r\n        if (hc != null) {\r\n            if (hc.leftActive) {\r\n                l = cc.v2(-1, -1);\r\n            }\r\n            if (hc.rightActive) {\r\n                r = cc.v2(-1, -1);\r\n            }\r\n            if (hc.topActive) {\r\n                t = cc.v2(-1, -1);\r\n            }\r\n            if (hc.bottomActive) {\r\n                d = cc.v2(-1, -1);\r\n            }\r\n        }\r\n\r\n        if (t) {\r\n            var tc = this.getCellByCoordinate(neighbors.t);\r\n            if (tc != null && tc.bottomActive) {\r\n                t = cc.v2(-1, -1);\r\n            }\r\n        }\r\n\r\n        if (d) {\r\n            var dc = this.getCellByCoordinate(neighbors.b);\r\n            if (dc != null && dc.topActive) {\r\n                d = cc.v2(-1, -1);\r\n            }\r\n        }\r\n\r\n        if (l) {\r\n            var lc = this.getCellByCoordinate(neighbors.l);\r\n            if (lc != null && lc.rightActive) {\r\n                l = cc.v2(-1, -1);\r\n            }\r\n        }\r\n\r\n        if (r) {\r\n            var rc = this.getCellByCoordinate(neighbors.r);\r\n            if (rc != null && rc.leftActive) {\r\n                r = cc.v2(-1, -1);\r\n            }\r\n        }\r\n\r\n        return [t, l, d, r]\r\n\r\n\r\n    },\r\n\r\n    createEnemy(enemys) {\r\n        var scale = hexTileHeight / 100;\r\n\r\n        if (enemys.length <= 0) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 0; i < enemys.length; i++) {\r\n            var enemy = enemys[i];\r\n            var hc = this.getCellByCoordinate(cc.v2(enemy.x, enemy.y));\r\n\r\n            var enemy_GO;\r\n            var random = Math.random();\r\n            if (random < 0.33) {\r\n                enemy_GO = cc.instantiate(this.enemyPrefab);\r\n            } else if (random < 0.66) {\r\n                enemy_GO = cc.instantiate(this.enemyPrefab1);\r\n            } else {\r\n                enemy_GO = cc.instantiate(this.enemyPrefab2);\r\n            }\r\n            enemy_GO.parent = this.tileBox;\r\n            enemy_GO.setScale(scale);\r\n            enemy_GO.setPosition(hc.node.getPosition());\r\n            enemy_GO.active = true;\r\n\r\n            //auto color colors\r\n            // enemy_GO.getChildByName(\"enemy\").color = cc.hexToColor(colors[Utils.GetRandomNum(0,colors.length-1)]);\r\n\r\n            var enemy = enemy_GO.getComponent(Enemy);\r\n            enemy.axialCoordinate = hc.axialCoordinate;\r\n            this.enemys.push(enemy);\r\n        }\r\n    },\r\n\r\n    createRole(start, end) {\r\n        var scale = hexTileHeight / 100;\r\n\r\n        start = this.checkXY(start, 0, 0);\r\n        end = this.checkXY(end, 0, 0);\r\n\r\n        var hc = this.getCellByCoordinate(cc.v2(start.x, start.y));\r\n        var hc1 = this.getCellByCoordinate(cc.v2(end.x, end.y));\r\n\r\n        var role_GO = cc.instantiate(this.rolePrefab);\r\n        role_GO.parent = this.tileBox;\r\n        role_GO.setScale(scale);\r\n        role_GO.setPosition(hc.node.getPosition());\r\n        role_GO.active = true;\r\n\r\n        var role = role_GO.getComponent(Role);\r\n        this.myRole = role;\r\n        this.myRole.init();\r\n        this.myRole.axialCoordinate = hc.axialCoordinate;\r\n        this.selectedLines.push(cc.v2(hc.axialCoordinate.x, hc.axialCoordinate.y));\r\n        var canMove = this.checkMove();\r\n        this.myRole.setArrow(canMove[0], canMove[1], canMove[2], canMove[3]);\r\n\r\n        var end_GO = cc.instantiate(this.endPrefab);\r\n        end_GO.parent = this.tileBox;\r\n        end_GO.setScale(scale);\r\n        end_GO.setPosition(hc1.node.getPosition());\r\n        end_GO.active = true;\r\n        this.endNode = end_GO;\r\n\r\n        var endObj = end_GO.getComponent(Role);\r\n        this.endObj = endObj;\r\n        this.endObj.axialCoordinate = hc1.axialCoordinate;\r\n\r\n        this.myRole.gameView = this;\r\n        this.myRole.setDark(mid == 4);\r\n\r\n    },\r\n\r\n    //发送碰撞即死亡\r\n    collisionCallback() {\r\n        // cc.log(this)\r\n        this.die();\r\n    },\r\n\r\n    //初始化格子\r\n    createGrid(_levelDimensions, walls, ices, towers, cb) {\r\n        this.gridOffset.x = 0;\r\n        this.gridOffset.y = 0;\r\n        var maxL = Math.max(_levelDimensions.x, _levelDimensions.y);\r\n        // cc.log (\"maxL:\" + maxL);\r\n        var winSize = cc.director.getWinSize();\r\n        var tileBoxSize = this.tileBox.getContentSize();\r\n        var tileBoxHeight = tileBoxSize.height;\r\n        var hexH = winSize.width;\r\n        hexTileHeight = (hexH - (lineWidth - lineWidth * _levelDimensions.x)) / _levelDimensions.x;\r\n        // cc.log(\"hexTileHeight:\",hexTileHeight);\r\n\r\n        var nowHeight = (hexTileHeight * _levelDimensions.y);\r\n\r\n        // cc.log(\"hexTileHeight:\",hexTileHeight);\r\n        // cc.log(\"tileBoxHeight:\",tileBoxHeight);\r\n        // cc.log(\"nowHeight:\",nowHeight);\r\n        // 1065    1335.1789638932496\r\n        if (tileBoxHeight < nowHeight) {\r\n            hexH = tileBoxSize.height;\r\n            var testHexTileHeight = (hexH - (lineWidth - lineWidth * _levelDimensions.y)) / _levelDimensions.y;\r\n            // cc.log(\"testHexTileHeight:\",testHexTileHeight);\r\n            if (testHexTileHeight < hexTileHeight) {\r\n                hexTileHeight = testHexTileHeight;\r\n                this.gridOffset.x = (winSize.width - (_levelDimensions.x * hexTileHeight) + _levelDimensions.x * lineWidth) * 0.5;\r\n            }\r\n            // cc.log(\"hexTileHeight:\",hexTileHeight);\r\n            // cc.log(\"winSize.width:\",winSize.width);\r\n            // cc.log(\"this.levelDimensions.x:\",this.levelDimensions.x);\r\n            // cc.log(\"this.levelDimensions.x * hexTileHeight:\",this.levelDimensions.x * hexTileHeight);\r\n\r\n        }\r\n\r\n        // cc.log(\"tileBox:\",this.tileBox.getContentSize());\r\n\r\n        sideLength = hexTileHeight;\r\n        // cc.log (\"sideLength:\" + sideLength);\r\n\r\n        var sizeW = sideLength;\r\n        var sizeH = sideLength;\r\n\r\n        this.levelDimensions = _levelDimensions;\r\n\r\n        var hexTile;\r\n        var hc;\r\n        var axialPoint = cc.v2(0, 0);\r\n        var screenPoint = cc.v2(0, 0);\r\n\r\n        var test = (tileBoxSize.height - (this.levelDimensions.y * hexTileHeight) + this.levelDimensions.y * lineWidth) * 0.5\r\n        this.gridOffset.y = (tileBoxSize.height * -1) + test;\r\n\r\n        //loop through the rows & columns \r\n\r\n        for (var i = 0; i < this.levelDimensions.x; i++) {\r\n            for (var j = 0; j < this.levelDimensions.y; j++) {\r\n                axialPoint.x = i;\r\n                axialPoint.y = j;\r\n                // cc.log(\"axialPoint:\",axialPoint);\r\n                //convert offset points to axial points\r\n                // axialPoint = Utils.offsetToAxial(axialPoint);\r\n                // cc.log(\"axialPoint:\",axialPoint);\r\n\r\n                //convert axial points to screen points\r\n                screenPoint = Utils.axialToScreen(axialPoint, sideLength);\r\n                // cc.log (\"screenPoint:\" ,screenPoint);\r\n                //add the grid offset value to position the grid\r\n                screenPoint.x += this.gridOffset.x;\r\n                screenPoint.y += this.gridOffset.y;\r\n\r\n                // cc.log (\"screenPoint:\" + screenPoint.x+\"___\"+screenPoint.y);\r\n                //place new hextile\r\n                hexTile = cc.instantiate(this.hexCellPrefab);\r\n                hexTile.parent = this.tileBox;\r\n\r\n                hexTile.setPosition(screenPoint.add(cc.v2(0, 1000)));\r\n                hexTile.setContentSize(cc.size(sizeW, sizeW));\r\n                hexTile.active = true;\r\n\r\n                var self = this;\r\n                if (j % 2 == 0) {\r\n                    hexTile.runAction(cc.sequence(\r\n                        cc.moveTo(0.2 + (0.05 * axialPoint.y), screenPoint.x, screenPoint.y),\r\n                        cc.callFunc(function () {\r\n                            self.gameApplication.soundManager.playSound(\"uplock\");\r\n                        })\r\n                    ));\r\n                    // hexTile.runAction(cc.moveTo(0.2+(0.05*axialPoint.y), screenPoint.x,screenPoint.y));\r\n                } else {\r\n                    hexTile.runAction(cc.moveTo(0.2 + (0.05 * axialPoint.y), screenPoint.x, screenPoint.y));\r\n                }\r\n\r\n\r\n\r\n                //we will identify hextile by name\r\n                hexTile.name = \"grid\" + i.toString() + \"_\" + j.toString();\r\n                hexTile.zIndex = 0;\r\n\r\n                hc = hexTile.getComponent(HexCell);\r\n                hc.scaleChild(sizeW / 100, sizeW / 100);\r\n\r\n                // //store the converted axial coordinate inside the hexcell for easier reference\r\n                hc.axialCoordinate = axialPoint;\r\n                // //add to the list\r\n                this.allCells.push(hc);\r\n            }\r\n        }\r\n\r\n        if (walls == null || walls.length <= 0) {\r\n            return;\r\n        }\r\n\r\n        var self = this;\r\n        var wx = 0, wy = 0, dx = 0, dy = 0;\r\n        for (var i = 0; i < walls.length; i++) {\r\n            // for(var i =0;i<20;i++){\r\n            var wall = walls[i];\r\n            var tmp_w1 = self.checkXY(wall['w1'], wx, wy);\r\n            var tmp_d1 = self.checkXY(wall['d1'], dx, dy);\r\n            var w1;\r\n            var d1;\r\n\r\n            // dx = d1.x;\r\n            // dy = d1.y; \r\n            // cc.log(\"w1:\",w1);\r\n            // cc.log(\"w1-x:\"+tmp_w1.x+\",w1-y:\"+tmp_w1.y+\"_____d1-x:\"+tmp_d1.x+\",d1-y:\"+tmp_d1.y);\r\n            //设置\r\n            var hc;\r\n            if (tmp_w1.x < tmp_d1.x || tmp_w1.y > tmp_d1.y) {\r\n                w1 = tmp_w1;\r\n                d1 = tmp_d1;\r\n            } else {\r\n                w1 = tmp_d1;\r\n                d1 = tmp_w1;\r\n            }\r\n\r\n            if (hc = this.getCellByCoordinate(cc.v2(w1.x, w1.y - 1))) {\r\n                if (w1.x == d1.x) {\r\n                    //画竖线\r\n                    // cc.log(\"setLeft\")\r\n                    hc.setLeft(true);\r\n                } else {\r\n                    // cc.log(\"setTop\")\r\n                    hc.setTop(true);\r\n\r\n                }\r\n            } else if (hc = this.getCellByCoordinate(cc.v2(w1.x, w1.y))) {\r\n                if (w1.x == d1.x) {\r\n                    // cc.log(\"setRight\")       \r\n                    hc.setRight(true);\r\n                } else {\r\n                    // cc.log(\"setBottom\")       \r\n                    hc.setBottom(true);\r\n\r\n                }\r\n            } else if (hc = this.getCellByCoordinate(cc.v2(w1.x - 1, w1.y - 1))) {\r\n                // cc.log(\"hchchchchc\",hc)\r\n                if (w1.x == d1.x) {\r\n                    // cc.log(\"seRight\")       \r\n                    hc.setRight(true);\r\n                } else {\r\n                    // cc.log(\"setBottom\")       \r\n                    hc.setBottom(true);\r\n\r\n                }\r\n            }\r\n        };\r\n\r\n        //播放动画\r\n        this.scheduleOnce(function () {\r\n\r\n            this.scheduleOnce(function () {\r\n                if (ices != null && ices.length > 0) {\r\n                    for (var i = 0; i < ices.length; i++) {\r\n                        var ice = ices[i];\r\n                        var hc = this.getCellByCoordinate(cc.v2(ice.x, ice.y));\r\n\r\n                        if (hc != null) {\r\n                            hc.setIce(true);\r\n                            var iceNode = cc.instantiate(this.icePrefab);\r\n                            iceNode.parent = this.iceBox;\r\n\r\n                            iceNode.setPosition(hc.node.getPosition());\r\n                            iceNode.setContentSize(hc.node.getContentSize());\r\n                            iceNode.active = true;\r\n\r\n                            iceNode.setScale(0.3, 0.3);\r\n                            iceNode.runAction(cc.scaleTo(0.35, 1, 1))\r\n                        }\r\n                    }\r\n                }\r\n            }.bind(this),1)\r\n\r\n\r\n            // cc.log(\"towers:\",towers)\r\n            if (towers != null && towers.length > 0) {\r\n                for (var i = 0; i < towers.length; i++) {\r\n                    var tower = towers[i];\r\n                    // cc.log(\"tower:\",tower)\r\n\r\n\r\n                    var tmp_w1 = self.checkXY(tower['w1'], wx, wy);\r\n                    var tmp_d1 = self.checkXY(tower['d1'], dx, dy);\r\n                    var w1;\r\n                    var d1;\r\n\r\n                    // dx = d1.x;\r\n                    // dy = d1.y; \r\n                    // cc.log(\"w1:\",w1);\r\n                    //设置\r\n                    var hc = null;\r\n                    if (tmp_w1.x < tmp_d1.x || tmp_w1.y > tmp_d1.y) {\r\n                        w1 = tmp_w1;\r\n                        d1 = tmp_d1;\r\n                    } else {\r\n                        w1 = tmp_d1;\r\n                        d1 = tmp_w1;\r\n                    }\r\n\r\n                    // cc.log(\"w1-x:\"+tmp_w1.x+\",w1-y:\"+tmp_w1.y+\"_____d1-x:\"+tmp_d1.x+\",d1-y:\"+tmp_d1.y);\r\n\r\n                    if (tower['direction'] == 1) {\r\n                        hc = this.getCellByCoordinate(cc.v2(Math.max(w1.x, d1.x) - 1, d1.y));\r\n                        if (hc == null) {\r\n                            hc = this.getCellByCoordinate(cc.v2(Math.max(w1.x, d1.x), d1.y));\r\n                        }\r\n                    }\r\n                    else if (tower['direction'] == 3) {\r\n                        hc = this.getCellByCoordinate(cc.v2(Math.max(w1.x, d1.x), d1.y));\r\n                        if (hc == null) {\r\n                            hc = this.getCellByCoordinate(cc.v2(Math.max(w1.x, d1.x) - 1, d1.y));\r\n                        }\r\n                    }\r\n                    else if (tower['direction'] == 0) {\r\n                        hc = this.getCellByCoordinate(cc.v2(w1.x, Math.min(w1.y, d1.y)));\r\n                        if (hc == null) {\r\n                            hc = this.getCellByCoordinate(cc.v2(w1.x, Math.max(w1.y, d1.y)));\r\n                        }\r\n                    }\r\n                    else if (tower['direction'] == 2) {\r\n                        hc = this.getCellByCoordinate(cc.v2(w1.x, Math.max(w1.y, d1.y) - 1));\r\n                        if (hc == null) {\r\n                            hc = this.getCellByCoordinate(cc.v2(w1.x, Math.max(w1.y, d1.y)));\r\n                        }\r\n                    }\r\n\r\n                    if (hc != null) {\r\n                        if (w1.x == d1.x) {\r\n                            //画竖线\r\n                            if (tower['direction'] == 1) {\r\n                                hc.setRightTower(true);\r\n                                this.pushTower(hc.rightTower, hc.axialCoordinate, tower);\r\n                            } else {\r\n                                hc.setLeftTower(true);\r\n                                this.pushTower(hc.leftTower, hc.axialCoordinate, tower);\r\n                            }\r\n                        } else {\r\n                            if (tower['direction'] == 0) {\r\n                                hc.setTopTower(true);\r\n                                this.pushTower(hc.topTower, hc.axialCoordinate, tower);\r\n                            } else {\r\n                                hc.setBottomTower(true);\r\n                                this.pushTower(hc.bottomTower, hc.axialCoordinate, tower);\r\n                            }\r\n                        }\r\n\r\n                        hc.node.zIndex = 1;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (cb) {\r\n                cb();\r\n            }\r\n        }.bind(this), 0.5 + (0.05 * this.levelDimensions.y));\r\n    },\r\n\r\n    //将tower push到this.allTowers\r\n    pushTower(node, axialCoordinate, config) {\r\n        var tower = node.getComponent(Tower);\r\n        tower.axialCoordinate = axialCoordinate;\r\n        tower.init(config);\r\n        this.allTowers.push(tower)\r\n    },\r\n\r\n\r\n    checkXY(dict, x, y) {\r\n        // if(dict['x'] == null && dict['y'] == null){\r\n        //     return null;\r\n        // }\r\n        // cc.log(\"dict:\",dict);\r\n        if (dict['x'] == null) {\r\n            dict['x'] = y;\r\n        }\r\n        if (dict['y'] == null) {\r\n            dict['y'] = x;\r\n        }\r\n\r\n        return dict;\r\n    },\r\n\r\n    updateUI() {\r\n\r\n        // JsonObject act = new JsonObject() { \r\n        //     { \"type\", \"updateUI\" },\r\n        // };\r\n        // DoLuaAction (act.ToString());\r\n\r\n        //\r\n        this.moves.string = this.movesLeft + \"/\" + this.maxValidMoves;\r\n        if (this.movesLeft <= 0 && mid == 1) {\r\n            this.gameOver = true;\r\n            window.gameApplication.showStepView(function (isOk) {\r\n                if (isOk) {\r\n                    this.gameOver = false;\r\n                    this.movesLeft = 5;\r\n                    this.updateUI();\r\n                } else {\r\n                    this.gameApplication.openMainView();\r\n                }\r\n            }.bind(this), false)\r\n        }\r\n    },\r\n\r\n    setStar(node, score, f) {\r\n        // var isFill = score >= f;\r\n        // node.getChildByName(\"empty\").active = !isFill;\r\n        // node.getChildByName(\"fill\").active = isFill;\r\n    },\r\n\r\n    onBackBtnClicked(event) {\r\n        if (this.gameApplication != null) {\r\n            this.gameApplication.soundManager.playSound(\"btn_click\");\r\n        }\r\n\r\n        this.gameApplication.openMainView();\r\n    },\r\n\r\n    onNextBtnClicked(event) {\r\n        var btn = event.target.getComponent(cc.Button);\r\n        btn.interactable = false;\r\n        this.scheduleOnce(function () {\r\n            btn.interactable = true;\r\n        }, 1);\r\n\r\n        // cc.log(\"onNextBtnClicked\")\r\n        this.gameApplication.soundManager.playSound(\"btn_click\");\r\n        this.nextGame(btn);\r\n    },\r\n\r\n    onPreviousBtnClicked(event) {\r\n        // cc.log(\"onPreviousBtnClicked\")\r\n        var btn = event.target.getComponent(cc.Button);\r\n        btn.interactable = false;\r\n        this.scheduleOnce(function () {\r\n            btn.interactable = true;\r\n        }, 1);\r\n\r\n        this.gameApplication.soundManager.playSound(\"btn_click\");\r\n        this.prevGame();\r\n    },\r\n\r\n    onReStarBtnClicked(event) {\r\n        this.timeIsUpNode.active = false;\r\n        var btn = event.target.getComponent(cc.Button);\r\n        btn.interactable = false;\r\n        this.scheduleOnce(function () {\r\n            btn.interactable = true;\r\n        }, 0.2);\r\n        window.gameApplication.soundManager.playSound(\"btn_click\");\r\n        window.gameApplication.openMainView();\r\n    },\r\n\r\n    onHelpBtnClicked(event) {\r\n\r\n        if (this.gameOver || this.myRole == null) {\r\n            return;\r\n        }\r\n        if (this.helpPath.length <= 0) {\r\n            return;\r\n        }\r\n        if (this.helpCount > 0) {\r\n            window.gameApplication.soundManager.playSound(\"btn_click\");\r\n            this.help();\r\n        } else {\r\n            window.gameApplication.soundManager.playSound(\"btn_click\");\r\n            this.shareFriendTip.active = true;\r\n        }\r\n    },\r\n\r\n\r\n\r\n    onWatchVideoBtnClicked(event) {\r\n        // this.gameApplication.soundManager.playSound(\"btn_click\");\r\n\r\n        // cc.log(\"onWatchVideoBtnClicked\");\r\n        event.target.getComponent(cc.Button).interactable = false;\r\n\r\n        var self = this;\r\n        SDK().showVideoAd(function (isCompleted) {\r\n            if (isCompleted) {\r\n                self.helpCount = plusHelp;\r\n            } else {\r\n                cc.log(\"播放视频广告失败\")\r\n            }\r\n\r\n            event.target.getComponent(cc.Button).interactable = true;\r\n            self.shareFriendTip.active = false;\r\n\r\n        }.bind(this));\r\n    },\r\n\r\n    onShareInvBtnClicked(event) {\r\n        // cc.log(\"onWatchVideoBtnClicked\");\r\n        // event.target.getComponent(cc.Button).interactable = false;\r\n        this.gameApplication.soundManager.playSound(\"btn_click\");\r\n\r\n        var self = this;\r\n        this.gameApplication.soundManager.playSound(\"done\");\r\n        SDK().getItem(\"all\", function (score) {\r\n            SDK().share(score, function (isCompleted) {\r\n                if (isCompleted) {\r\n                    self.helpCount = plusHelp;\r\n                    console.log(\"邀请成功\")\r\n                } else {\r\n                    console.log(\"邀请失败\")\r\n                    self.showInvAgain(1, event);\r\n                }\r\n                event.target.getComponent(cc.Button).interactable = true;\r\n                self.shareFriendTip.active = false;\r\n            });\r\n\r\n        }.bind(this));\r\n    },\r\n\r\n    showInvAgain(type, event) {\r\n        var self = this;\r\n        this.invAgain.active = true;\r\n        var btn = cc.find(\"box/btn_4\", this.invAgain).getComponent(cc.Button);\r\n        btn.node.on('click', function () {\r\n            if (type == 1) {\r\n                self.onShareInvBtnClicked(event);\r\n            } else if (type == 2) {\r\n                self.onShareBtnClicked(event);\r\n            } else if (type == 3) {\r\n                self.getMoreTimeInv(event);\r\n            }\r\n            self.invAgain.active = false;\r\n        }, this);\r\n    },\r\n\r\n    onCloseWatchVideoTipClicked() {\r\n        this.gameApplication.soundManager.playSound(\"btn_click\");\r\n        this.shareFriendTip.active = false;\r\n    },\r\n\r\n\r\n    onShareBtnClicked(event) {\r\n        var self = this;\r\n        this.gameApplication.soundManager.playSound(\"btn_click\");\r\n        event.target.getComponent(cc.Button).interactable = false;\r\n        event.target.active = true;\r\n\r\n        this.gameApplication.soundManager.playSound(\"done\");\r\n        SDK().getItem(\"all\", function (score) {\r\n            SDK().share(score, function (isCompleted) {\r\n                event.target.getComponent(cc.Button).interactable = true;\r\n                event.target.active = true;\r\n                if (!isCompleted) {\r\n                    self.showInvAgain(2, event);\r\n                }\r\n\r\n            });\r\n\r\n        }.bind(this));\r\n    },\r\n\r\n    helpBtnShake() {\r\n        this.helpBtn.getComponent(\"AnimFunc\").shake();\r\n    },\r\n\r\n    onGiftBtnClicked() {\r\n        this.receiveGiftNode.active = false;\r\n    },\r\n\r\n\r\n\r\n    onPlayInterstitialGiftBtnClicked(event) {\r\n        // event.target.getComponent(cc.Button).interactable = false;\r\n        var self = this;\r\n\r\n        self.gameApplication.soundManager.playSound(\"done\");\r\n        SDK().showInterstitialAd(function (isCompleted) {\r\n            self.helpCount += 1;\r\n            // event.target.getComponent(cc.Button).interactable = true;\r\n            self.receiveGiftNode.active = true;\r\n            self.giftBtn.active = false;\r\n            console.log(\"_______OKOK\")\r\n        }, true);\r\n    }\r\n\r\n});\r\n"]}