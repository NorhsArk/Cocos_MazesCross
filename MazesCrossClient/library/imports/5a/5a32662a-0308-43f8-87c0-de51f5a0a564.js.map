{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\UI/assets\\Script\\UI\\MainView.js"],"names":["stageColor","cc","color","gray","Class","extends","Component","properties","title","default","type","Label","hearts","Node","starts","coins","content","scrollView","ScrollView","stageItem","missionSpriteAtlas","SpriteAtlas","missions","gameApplication","Object","missionNodes","curIdx","Integer","visible","minIdx","maxIdx","uiAtlas","reTime","Float","reviveBtn","Button","reviveTime","reviveNum","onLoad","SDK","getItem","count","string","bind","reviveHeartCount","node","width","winSize","height","window","mainScirpt","find","getComponent","init","on","scorllToBottom","scorllToTop","event","initStage","keys","length","getMissions","results","initContents","score","toString","onEnable","refreashVal","heart","coin","active","lastPlay","val","initMissionItem","initMission","scheduleOnce","menuClick","curMission","judgeType","mission","bigStage","cannonNode","instantiate","parent","name","tag","lockCount","islock","i","item","mlInfo","judgeML","lid","stars","small","Sprite","num","curPoint","lock","runAction","repeatForever","sequence","moveBy","v2","mid","arr","push","forEach","tmp_lid","tmp_path","getConf","stopAllActions","spriteFrame","getSpriteFrame","info","idx","initStageClick","checkstagePass","off","EventType","TOUCH_END","setSiblingIndex","star","stageInfo","goGame","soundManager","playSound","target","showSharaView","isComplited","param","setItem","flyReward","showHeartView","bid","openGameView","stage","disVal","isFix","Math","floor","fixCount","hideAllItem","childrenCount","children","n","destroy","showCoinView","isCompleted","fix","maxScrollOffset","getMaxScrollOffset","scrollToOffset","p","y","parseInt","reHeart","Heart","abs","temp","tempMin","min","sec","update","dt"],"mappings":";;;;;;AAAA;;AAEA,IAAIA,aAAa,CACbC,GAAGC,KAAH,CAAS,GAAT,EAAc,GAAd,EAAmB,EAAnB,EAAuB,GAAvB,CADa,EAEbD,GAAGC,KAAH,CAAS,GAAT,EAAc,EAAd,EAAkB,GAAlB,EAAuB,GAAvB,CAFa,EAGbD,GAAGC,KAAH,CAAS,EAAT,EAAa,GAAb,EAAkB,GAAlB,EAAuB,GAAvB,CAHa,EAIbD,GAAGC,KAAH,CAAS,EAAT,EAAa,EAAb,EAAiB,EAAjB,EAAqB,GAArB,CAJa,EAKbD,GAAGC,KAAH,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,EAAkB,GAAlB,CALa,EAMbD,GAAGC,KAAH,CAAS,CAAT,EAAY,GAAZ,EAAiB,GAAjB,EAAsB,GAAtB,CANa,CAAjB;AAQA,IAAIC,OAAOF,GAAGC,KAAH,CAAS,GAAT,EAAc,GAAd,EAAmB,GAAnB,EAAwB,GAAxB,CAAX;AACAD,GAAGG,KAAH,CAAS;AACLC,aAASJ,GAAGK,SADP;;AAGLC,gBAAY;AACRC,eAAO;AACHC,qBAAS,IADN;AAEHC,kBAAMT,GAAGU;AAFN,SADC;AAKRC,gBAAQ;AACJH,qBAAS,IADL;AAEJC,kBAAMT,GAAGY;AAFL,SALA;AASRC,gBAAQ;AACJL,qBAAS,IADL;AAEJC,kBAAMT,GAAGY;AAFL,SATA;AAaRE,eAAO;AACHN,qBAAS,IADN;AAEHC,kBAAMT,GAAGY;AAFN,SAbC;AAiBRG,iBAAS;AACLP,qBAAS,IADJ;AAELC,kBAAMT,GAAGY;AAFJ,SAjBD;AAqBRI,oBAAY;AACRR,qBAAS,IADD;AAERC,kBAAMT,GAAGiB;AAFD,SArBJ;AAyBRC,mBAAW;AACPV,qBAAS,IADF;AAEPC,kBAAMT,GAAGY;AAFF,SAzBH;AA6BRO,4BAAoB;AAChBX,qBAAS,IADO;AAEhBC,kBAAMT,GAAGoB;AAFO,SA7BZ;AAiCRC,kBAAU;AACNb,qBAAS;AADH,SAjCF;AAoCRc,yBAAiB;AACbd,qBAAS,IADI;AAEbC,kBAAMc;AAFO,SApCT;AAwCRC,sBAAc;AACVhB,qBAAS;AADC,SAxCN;AA2CRiB,gBAAQ;AACJjB,qBAAS,CADL;AAEJC,kBAAMT,GAAG0B,OAFL;AAGJC,qBAAS;AAHL,SA3CA;AAgDRC,gBAAQ;AACJpB,qBAAS,CADL;AAEJC,kBAAMT,GAAG0B,OAFL;AAGJC,qBAAS;AAHL,SAhDA;AAqDRE,gBAAQ;AACJrB,qBAAS,CADL;AAEJC,kBAAMT,GAAG0B,OAFL;AAGJC,qBAAS;AAHL,SArDA;AA0DRG,iBAAS;AACLtB,qBAAS,IADJ;AAELC,kBAAMT,GAAGoB;AAFJ,SA1DD;AA8DRW,gBAAQ;AACJvB,qBAAS,CADL;AAEJC,kBAAMT,GAAGgC,KAFL;AAGJL,qBAAS;AAHL,SA9DA;AAmERM,mBAAW;AACPzB,qBAAS,IADF;AAEPC,kBAAMT,GAAGkC;AAFF,SAnEH;AAuERC,oBAAY;AACR3B,qBAAS,IADD;AAERC,kBAAMT,GAAGU;AAFD,SAvEJ;AA2ER0B,mBAAW;AACP5B,qBAAS,IADF;AAEPC,kBAAMT,GAAGU;AAFF;AA3EH,KAHP;;AAoFL2B,YAAQ,kBAAY;AAChB,aAAKN,MAAL,GAAc,GAAd;AACAO,cAAMC,OAAN,CAAc,SAAd,EAAyB,UAAUC,KAAV,EAAiB;AACtC,iBAAKJ,SAAL,CAAeK,MAAf,GAAwBD,KAAxB;AACH,SAFwB,CAEvBE,IAFuB,CAElB,IAFkB,CAAzB;AAGA,aAAKC,gBAAL;AACA,aAAKC,IAAL,CAAUC,KAAV,GAAkB7C,GAAG8C,OAAH,CAAWD,KAA7B;AACA,aAAKD,IAAL,CAAUG,MAAV,GAAmB/C,GAAG8C,OAAH,CAAWC,MAA9B;AACAC,eAAOC,UAAP,GAAoB,IAApB;AACA,aAAK3B,eAAL,GAAuBtB,GAAGkD,IAAH,CAAQ,iBAAR,EAA2BC,YAA3B,CAAwC,iBAAxC,CAAvB;AACA,aAAKC,IAAL;;AAGA,aAAKpC,UAAL,CAAgB4B,IAAhB,CAAqBS,EAArB,CAAwB,kBAAxB,EAA4C,KAAKC,cAAjD,EAAiE,IAAjE;;AAEA,aAAKtC,UAAL,CAAgB4B,IAAhB,CAAqBS,EAArB,CAAwB,eAAxB,EAAyC,KAAKE,WAA9C,EAA2D,IAA3D;;AAEA;;AAEA,aAAK3B,MAAL,GAAc,IAAd;AACA,aAAKC,MAAL,GAAc,IAAd;AACH,KAzGI;;AA2GLyB,kBA3GK,0BA2GUE,KA3GV,EA2GiB;AAClB,YAAI,KAAK5B,MAAL,GAAc,CAAlB,EAAqB;AACjB,iBAAK6B,SAAL,CAAe,KAAK7B,MAAL,GAAc,EAA7B;AACH;AACJ,KA/GI;AAiHL2B,eAjHK,uBAiHOC,KAjHP,EAiHc;AACf,YAAI,KAAK3B,MAAL,GAAc,GAAlB,EAAuB;AACnB,iBAAK4B,SAAL,CAAe,KAAK5B,MAAL,GAAc,EAA7B;AACH;AACJ,KArHI;AAuHLuB,QAvHK,kBAuHE;AACH,YAAI,KAAK/B,QAAL,IAAiB,IAAjB,IAAyBE,OAAOmC,IAAP,CAAY,KAAKrC,QAAjB,EAA2BsC,MAA3B,IAAqC,CAAlE,EAAqE;AACjE,iBAAKrC,eAAL,CAAqBsC,WAArB,CAAiC,UAAUC,OAAV,EAAmB;AAChD,qBAAKxC,QAAL,GAAgBwC,OAAhB;AACA,qBAAKC,YAAL;AACH,aAHgC,CAG/BpB,IAH+B,CAG1B,IAH0B,CAAjC;AAIH,SALD,MAKO;AACH,iBAAKoB,YAAL;AACH;;AAEDxB,cAAMC,OAAN,CAAc,KAAd,EAAqB,UAAUwB,KAAV,EAAiB;AAClC,iBAAKlD,MAAL,CAAYsC,YAAZ,CAAyBnD,GAAGU,KAA5B,EAAmC+B,MAAnC,GAA4CsB,MAAMC,QAAN,EAA5C;AACH,SAFoB,CAEnBtB,IAFmB,CAEd,IAFc,CAArB;AAIH,KArII;AAuILuB,YAvIK,sBAuIM;AACP,YAAI,KAAK5C,QAAL,IAAiB,IAAjB,IAAyBE,OAAOmC,IAAP,CAAY,KAAKrC,QAAjB,EAA2BsC,MAA3B,GAAoC,CAAjE,EAAoE;AAChE,iBAAKG,YAAL;AACH;AACD,aAAKI,WAAL;AACH,KA5II;AA8ILA,eA9IK,yBA8IS;AACV,YAAI,KAAKrD,MAAL,IAAe,IAAnB,EAAyB;AACrB;AACH;AACDyB,cAAMC,OAAN,CAAc,KAAd,EAAqB,UAAUwB,KAAV,EAAiB;AAClC,iBAAKlD,MAAL,CAAYsC,YAAZ,CAAyBnD,GAAGU,KAA5B,EAAmC+B,MAAnC,GAA4CsB,MAAMC,QAAN,EAA5C;AACH,SAFoB,CAEnBtB,IAFmB,CAEd,IAFc,CAArB;;AAIAJ,cAAMC,OAAN,CAAc,QAAd,EAAwB,UAAU4B,KAAV,EAAiB;AACrC,iBAAKxD,MAAL,CAAYwC,YAAZ,CAAyBnD,GAAGU,KAA5B,EAAmC+B,MAAnC,GAA4C0B,MAAMH,QAAN,EAA5C;AACH,SAFuB,CAEtBtB,IAFsB,CAEjB,IAFiB,CAAxB;;AAIAJ,cAAMC,OAAN,CAAc,OAAd,EAAuB,UAAU6B,IAAV,EAAgB;AACnC,iBAAKtD,KAAL,CAAWqC,YAAX,CAAwBnD,GAAGU,KAA3B,EAAkC+B,MAAlC,GAA2C2B,KAAKJ,QAAL,EAA3C;AACH,SAFsB,CAErBtB,IAFqB,CAEhB,IAFgB,CAAvB;AAGH,KA7JI;;;AA+JL;AACAoB,gBAhKK,0BAgKU;AACX,aAAK/C,OAAL,CAAasD,MAAb,GAAsB,KAAtB;AACA,YAAIrB,OAAOsB,QAAP,IAAmB,IAAvB,EAA6B;AACzB,iBAAKb,SAAL,CAAeT,OAAOsB,QAAtB;AACA,iBAAKvD,OAAL,CAAasD,MAAb,GAAsB,IAAtB;AACH,SAHD,MAGO;AACH/B,kBAAMC,OAAN,CAAc,QAAd,EAAwB,UAAUgC,GAAV,EAAe;AACnC,oBAAIA,OAAO,IAAX,EAAiB;AACbA,0BAAM,CAAN;AACH;AACDvB,uBAAOvB,MAAP,GAAgB8C,GAAhB;AACA,qBAAKC,eAAL,CAAqBD,GAArB;AACA,qBAAKxD,OAAL,CAAasD,MAAb,GAAsB,IAAtB;AACH,aAPuB,CAOtB3B,IAPsB,CAOjB,IAPiB,CAAxB;AAQH;AACJ,KA/KI;;;AAiLL;AACA8B,mBAlLK,2BAkLWD,GAlLX,EAkLgB;AACjB,YAAIE,WAAJ;AACA,YAAIF,OAAO,EAAX,EAAe;AACX,iBAAKd,SAAL,CAAec,MAAM,EAArB;AACH;AACD,aAAKd,SAAL,CAAec,GAAf;AACA,YAAIA,MAAM,GAAV,EAAe;AACX,iBAAKd,SAAL,CAAec,MAAM,EAArB;AACH;AACD,aAAKG,YAAL,CAAkB,YAAY;AAC1B,iBAAKC,SAAL,CAAe,IAAf,EAAqB,OAArB;AACH,SAFiB,CAEhBjC,IAFgB,CAEX,IAFW,CAAlB,EAEc,CAFd;AAGH,KA9LI;;;AAgML;AACAe,aAjMK,qBAiMKc,GAjML,EAiMU;AACX,YAAIK,aAAa,KAAKC,SAAL,CAAeN,GAAf,CAAjB;AACA;AACA;AACA,YAAIO,UAAU,KAAKzD,QAAL,CAAcuD,WAAWnE,IAAzB,CAAd;AACA,YAAIsE,WAAWH,WAAWG,QAA1B;;AAEA,YAAIC,aAAa,KAAKxD,YAAL,CAAkBuD,QAAlB,CAAjB;AACA,YAAIC,cAAc,IAAlB,EAAwB;AACpBA,yBAAahF,GAAGiF,WAAH,CAAe,KAAK/D,SAApB,CAAb;AACH;;AAED8D,mBAAWE,MAAX,GAAoB,KAAKnE,OAAzB;AACAiE,mBAAWG,IAAX,GAAkB,KAAKJ,QAAvB;AACAC,mBAAWI,GAAX,GAAiBR,WAAWnE,IAA5B;;AAEA;AACA6B,cAAMC,OAAN,CAAc,UAAUwC,QAAxB,EAAkC,UAAUM,SAAV,EAAqB;AACnD,gBAAIC,SAAS,KAAb;AACA,gBAAID,YAAY,CAAhB,EAAmB;AACfC,yBAAS,KAAT;AACH;AACD,gBAAIP,YAAY,CAAhB,EAAmB;AACfO,yBAAS,KAAT;AACH;AACD;AACA,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,EAApB,EAAwBA,IAAIA,IAAI,CAAhC,EAAmC;AAC/B;AACA,oBAAIC,OAAOxF,GAAGkD,IAAH,CAAQ,aAAaqC,CAArB,EAAwBP,UAAxB,CAAX;AACA,oBAAIT,MAAMgB,IAAIR,QAAd;;AAEA;AACA,oBAAIU,SAAS,KAAKC,OAAL,CAAad,UAAb,EAAyBW,CAAzB,CAAb;AACA;;AAEAC,qBAAKJ,GAAL,GAAWb,GAAX;;AAEA;AACA,oBAAIkB,OAAOE,GAAP,GAAab,QAAQc,KAAzB,EAAgC;AAC5BJ,yBAAKnB,MAAL,GAAc,KAAd;AACH,iBAFD,MAEO;AACHmB,yBAAKnB,MAAL,GAAc,IAAd;;AAEA;AACA,wBAAIwB,QAAQ7F,GAAGkD,IAAH,CAAQ,OAAR,EAAiBsC,IAAjB,EAAuBrC,YAAvB,CAAoCnD,GAAG8F,MAAvC,CAAZ;AACA,wBAAIC,MAAM/F,GAAGkD,IAAH,CAAQ,KAAR,EAAe2C,MAAMjD,IAArB,EAA2BO,YAA3B,CAAwCnD,GAAGU,KAA3C,CAAV;AACA,wBAAIsF,WAAWhG,GAAGkD,IAAH,CAAQ,UAAR,EAAoB2C,MAAMjD,IAA1B,CAAf;AACA,wBAAIqD,OAAOjG,GAAGkD,IAAH,CAAQ,MAAR,EAAgB2C,MAAMjD,IAAtB,CAAX;;AAEA;AACA,wBAAI2B,MAAM,EAAN,IAAY,CAAhB,EAAmB;AACfwB,4BAAItD,MAAJ,GAAa,EAAb;AACA,4BAAI8B,OAAO,CAAX,EAAc;AACVwB,gCAAItD,MAAJ,GAAa,EAAb;AACH;AACJ,qBALD,MAKO;AACHsD,4BAAItD,MAAJ,GAAa8B,GAAb;AACH;;AAED;AACA,wBAAIA,OAAOvB,OAAOvB,MAAlB,EAA0B;AACtBuE,iCAAS3B,MAAT,GAAkB,IAAlB;AACA2B,iCAASE,SAAT,CACIlG,GAAGmG,aAAH,CACInG,GAAGoG,QAAH,CACIpG,GAAGqG,MAAH,CAAU,GAAV,EAAerG,GAAGsG,EAAH,CAAM,CAAN,EAAS,EAAT,CAAf,CADJ,EAEItG,GAAGqG,MAAH,CAAU,GAAV,EAAerG,GAAGsG,EAAH,CAAM,CAAN,EAAS,CAAC,EAAV,CAAf,CAFJ,CADJ,CADJ;AAQA;AACA,4BAAIC,MAAMd,OAAOc,GAAjB;AACA,4BAAIZ,MAAMF,OAAOE,GAAjB;AACA,4BAAIY,OAAO,IAAP,IAAeA,MAAM,CAArB,IAA0BZ,OAAO,IAAjC,IAAyCA,MAAM,CAAnD,EAAsD;AAClD;AACA,gCAAIa,MAAM,EAAV;AACA,gCAAIb,MAAM,CAAV,EAAa;AACTa,oCAAIC,IAAJ,CAASd,MAAM,CAAf;AACH;AACDa,gCAAIC,IAAJ,CAASd,GAAT;AACA,gCAAIA,MAAM,GAAV,EAAe;AACXa,oCAAIC,IAAJ,CAASd,MAAM,CAAf;AACH;AACDa,gCAAIE,OAAJ,CAAY,UAAUC,OAAV,EAAmB;AAC3B,oCAAIC,WAAW,yBAAyB,CAAzB,GAA6B,GAA7B,GAAmCL,GAAnC,GAAyC,GAAzC,GAA+CI,OAA9D;AACA3D,uCAAO1B,eAAP,CAAuBuF,OAAvB,CAA+BD,QAA/B,EAAyC,IAAzC;AACH,6BAHD;AAIH;AACJ,qBA5BD,MA4BO;AACHZ,iCAASc,cAAT;AACAd,iCAAS3B,MAAT,GAAkB,KAAlB;AACH;;AAED;AACA,wBAAIE,OAAOQ,QAAX,EAAqB;AACjBc,8BAAMkB,WAAN,GAAoB,KAAKjF,OAAL,CAAakF,cAAb,CAA4BpC,WAAWnE,IAAX,GAAkB,KAA9C,CAApB;AACAoF,8BAAMjD,IAAN,CAAW3C,KAAX,GAAmBD,GAAGC,KAAH,CAAS,GAAT,EAAa,GAAb,EAAiB,GAAjB,EAAqB,GAArB,CAAnB;AACH,qBAHD,MAGO;AACH4F,8BAAMjD,IAAN,CAAW3C,KAAX,GAAmBC,IAAnB;AACH;;AAED;AACA,wBAAI,CAACoF,MAAL,EAAa;AACTW,6BAAK5B,MAAL,GAAc,KAAd;;AAEA;AACA,4BAAI4C,OAAO,EAAX;AACAA,6BAAKV,GAAL,GAAWd,OAAOc,GAAlB;AACAU,6BAAKtB,GAAL,GAAWF,OAAOE,GAAlB;AACAsB,6BAAKlC,QAAL,GAAgBH,WAAWG,QAA3B;AACAkC,6BAAKC,GAAL,GAAW3B,CAAX;;AAEA;AACA,4BAAIhB,OAAOvB,OAAOvB,MAAd,IAAwB,IAA5B,EAAkC;AAC9B,iCAAK0F,cAAL,CAAoBF,IAApB,EAA0BzB,IAA1B,EAAgCF,MAAhC;AACH;AACD,6BAAK8B,cAAL,CAAoB3B,MAApB,EAA4BlB,GAA5B,EAAiCsB,KAAjC,EAAwCjB,UAAxC;AACH,qBAfD,MAeO;AACHqB,6BAAK5B,MAAL,GAAc,IAAd;AACA;AACAmB,6BAAK6B,GAAL,CAASrH,GAAGY,IAAH,CAAQ0G,SAAR,CAAkBC,SAA3B;AACA,4BAAIhD,MAAM,EAAN,IAAY,CAAhB,EAAmB;AACf0B,iCAAK5B,MAAL,GAAc,KAAd;AACA,gCAAI4C,OAAO,EAAX;AACAA,iCAAKV,GAAL,GAAWd,OAAOc,GAAlB;AACAU,iCAAKtB,GAAL,GAAWF,OAAOE,GAAlB;AACAsB,iCAAKlC,QAAL,GAAgBH,WAAWG,QAA3B;AACAkC,iCAAKC,GAAL,GAAW3B,CAAX;AACA,iCAAK4B,cAAL,CAAoBF,IAApB,EAA0BzB,IAA1B,EAAgCF,MAAhC;AACH;AACJ;AACJ;AACJ;AACDN,uBAAWX,MAAX,GAAoB,IAApB;AACA,iBAAK7C,YAAL,CAAkBuD,QAAlB,IAA8BC,UAA9B;;AAEA,gBAAID,WAAW,KAAKlD,MAAhB,IAA0B,KAAKA,MAAL,IAAe,IAA7C,EAAmD;AAC/C,qBAAKA,MAAL,GAAckD,QAAd;AACH;AACD,gBAAIA,WAAW,KAAKnD,MAAhB,IAA0B,KAAKA,MAAL,IAAe,IAA7C,EAAmD;AAC/C,qBAAKA,MAAL,GAAcmD,QAAd;AACAC,2BAAWwC,eAAX,CAA2B,CAA3B;AACH;AACJ,SA9HiC,CA8HhC9E,IA9HgC,CA8H3B,IA9H2B,CAAlC;AA+HH,KAjVI;;;AAmVL;AACA0E,kBApVK,0BAoVU3B,MApVV,EAoVkBlB,GApVlB,EAoVuBsB,KApVvB,EAoV8BjB,UApV9B,EAoV0C;AAC3C;AACAtC,cAAMC,OAAN,CAAc,OAAOkD,OAAOc,GAAd,GAAoB,GAApB,GAA0Bd,OAAOE,GAA/C,EAAoD,UAAU8B,IAAV,EAAgB;AAChE;AACA,gBAAIA,OAAO,CAAX,EAAc;AACV,oBAAIlD,MAAM,EAAN,IAAY,CAAhB,EAAmB;AACfsB,0BAAMjD,IAAN,CAAW3C,KAAX,GAAmBF,WAAW6E,WAAWnE,IAAtB,CAAnB;AACH;AACJ;AACJ,SAPmD,CAOlDiC,IAPkD,CAO7C,IAP6C,CAApD;AAQH,KA9VI;AAiWLyE,kBAjWK,0BAiWUO,SAjWV,EAiWqBlC,IAjWrB,EAiW2BF,MAjW3B,EAiWmC;AACpC,YAAIqC,SAAS3H,GAAGkD,IAAH,CAAQ,QAAR,EAAkB,KAAKN,IAAvB,CAAb;AACA4C,aAAK6B,GAAL,CAASrH,GAAGY,IAAH,CAAQ0G,SAAR,CAAkBC,SAA3B;AACA;AACA/B,aAAKnC,EAAL,CAAQrD,GAAGY,IAAH,CAAQ0G,SAAR,CAAkBC,SAA1B,EAAqC,UAAU/D,KAAV,EAAiB;AAClD,gBAAImE,UAAU,IAAd,EAAoB;AAChBA,uBAAOtD,MAAP,GAAgB,IAAhB;AACH;AACD,iBAAK/C,eAAL,CAAqBsG,YAArB,CAAkCC,SAAlC,CAA4C,WAA5C;AACA,gBAAIX,MAAM1D,MAAMsE,MAAN,CAAa1C,GAAvB;AACA;AACA,gBAAI8B,MAAM,EAAN,IAAY,CAAZ,IAAiBA,OAAO,CAAxB,IAA6B5B,MAAjC,EAAyC;AACrC,qBAAKhE,eAAL,CAAqByG,aAArB,CAAmC,UAAUC,WAAV,EAAuB;AACtD,wBAAIA,WAAJ,EAAiB;AACb,4BAAIC,QAAQ,EAAZ;AACAA,8BAAM,UAAUP,UAAU3C,QAA1B,IAAsC,CAAtC;AACAzC,8BAAM4F,OAAN,CAAcD,KAAd,EAAqB,YAAY;AAC7B,iCAAKxE,SAAL,CAAeiE,UAAU3C,QAAzB;AACH,yBAFoB,CAEnBrC,IAFmB,CAEd,IAFc,CAArB;AAGH;AACD,wBAAIiF,UAAU,IAAd,EAAoB;AAChBA,+BAAOtD,MAAP,GAAgB,KAAhB;AACH;AACJ,iBAXkC,CAWjC3B,IAXiC,CAW5B,IAX4B,CAAnC;AAYH,aAbD,MAaO;AACHJ,sBAAMC,OAAN,CAAc,QAAd,EAAwB,UAAU4B,KAAV,EAAiB;AACrC;AACA,wBAAIA,QAAQ,CAAZ,EAAe;AACX;AACAA,gCAAQA,QAAQ,CAAhB;AACA7B,8BAAM4F,OAAN,CAAc,EAAEvH,QAAQwD,KAAV,EAAd;AACA,4BAAI,KAAKxD,MAAL,IAAe,IAAnB,EAAyB;AACrB,iCAAKA,MAAL,CAAYwC,YAAZ,CAAyBnD,GAAGU,KAA5B,EAAmC+B,MAAnC,GAA4C0B,KAA5C;AACH;AACDnB,+BAAO1B,eAAP,CAAuB6G,SAAvB,CAAiC,CAAjC,EAAoC,aAApC,EAAmD3C,IAAnD,EAAyD,KAAK7E,MAA9D,EAAsE,YAAY;AAC9E,iCAAKgH,MAAL,CAAYD,SAAZ,EAAuBlC,IAAvB,EAA6BF,MAA7B;AACH,yBAFqE,CAEpE5C,IAFoE,CAE/D,IAF+D,CAAtE;AAGH,qBAVD,MAUO;AACH;AACAM,+BAAO1B,eAAP,CAAuB8G,aAAvB,CAAqC,UAAUJ,WAAV,EAAuB;AACxD,gCAAIA,WAAJ,EAAiB;AACb7D,wCAAQ,CAAR;AACA,oCAAI,KAAKxD,MAAL,IAAe,IAAnB,EAAyB;AACrB,yCAAKA,MAAL,CAAYwC,YAAZ,CAAyBnD,GAAGU,KAA5B,EAAmC+B,MAAnC,GAA4C0B,KAA5C;AACH;AACD7B,sCAAM4F,OAAN,CAAc,EAAEvH,QAAQwD,KAAV,EAAd;AACAnB,uCAAO1B,eAAP,CAAuB6G,SAAvB,CAAiC,CAAjC,EAAoC,aAApC,EAAmD3C,IAAnD,EAAyD,KAAK7E,MAA9D,EAAsE,YAAY;AAC9E,yCAAKgH,MAAL,CAAYD,SAAZ,EAAuBlC,IAAvB,EAA6BF,MAA7B;AACH,iCAFqE,CAEpE5C,IAFoE,CAE/D,IAF+D,CAAtE;AAGH,6BATD,MASO;AACH,oCAAIiF,UAAU,IAAd,EAAoB;AAChBA,2CAAOtD,MAAP,GAAgB,KAAhB;AACH;AACJ;AACJ,yBAfoC,CAenC3B,IAfmC,CAe9B,IAf8B,CAArC,EAec,KAfd;AAgBH;AACJ,iBA/BuB,CA+BtBA,IA/BsB,CA+BjB,IA/BiB,CAAxB;AAgCH;AACJ,SAtDD,EAsDG,IAtDH;AAuDH,KA5ZI;AA8ZLiF,UA9ZK,kBA8ZED,SA9ZF,EA8ZalC,IA9Zb,EA8ZmBF,MA9ZnB,EA8Z2B;AAC5B;AACAtC,eAAOqF,GAAP,GAAa,CAAb;AACArF,eAAOuD,GAAP,GAAamB,UAAUnB,GAAvB;AACAvD,eAAO2C,GAAP,GAAa+B,UAAU/B,GAAvB;AACA,aAAKrE,eAAL,CAAqBgH,YAArB;AACH,KApaI;;;AAsaL;AACAzD,aAvaK,qBAuaK0D,KAvaL,EAuaY;AACb,YAAI/F,QAAQ,CAAZ;AACA,YAAIgG,SAAS,EAAb;AACA,YAAIC,QAAQ,KAAZ;;AAEA;AACA,YAAIF,SAAS,GAAb,EAAkB;AACdA,oBAAQA,QAAQ,GAAhB;AACAE,oBAAQ,IAAR;AACAD,qBAAS,EAAT;AACH;AACD,eAAOD,SAASC,MAAhB,EAAwB;AACpBD,oBAAQA,QAAQC,MAAhB;AACAhG,oBAAQA,QAAQ,CAAhB;AACH;AACD+F,gBAAQG,KAAKC,KAAL,CAAWJ,QAAQ,EAAnB,CAAR;;AAEA,YAAIN,QAAQ,EAAZ;AACAA,cAAMxH,IAAN,GAAa8H,KAAb;AACAN,cAAMzF,KAAN,GAAcA,KAAd;AACAyF,cAAMlD,QAAN,GAAkBwD,QAAQ,EAAT,GAAgB/F,QAAQgG,MAAzC;AACA,YAAIC,KAAJ,EAAW;AACPR,kBAAMlD,QAAN,GAAiBkD,MAAMlD,QAAN,GAAiB,GAAlC;AACH;AACD,eAAOkD,KAAP;AACH,KAhcI;;;AAkcL;AACAvC,WAncK,mBAmcGd,UAncH,EAmceW,CAncf,EAmckB;AACnB,YAAI0B,OAAO,EAAX;AACAA,aAAKV,GAAL,GAAW3B,WAAWnE,IAAX,GAAkB,CAA7B;AACA,YAAImI,WAAW,CAAf;AACA,YAAIhE,WAAWG,QAAX,IAAuB,GAA3B,EAAgC;AAC5B6D,uBAAW,CAAX;AACH;AACD3B,aAAKtB,GAAL,GAAW,IAAIJ,CAAJ,GAAS,CAACqD,WAAWhE,WAAWpC,KAAvB,IAAgC,EAApD;AACA,eAAOyE,IAAP;AACH,KA5cI;AA8cL4B,eA9cK,yBA8cS;AACV,YAAI,KAAK9H,OAAL,CAAa+H,aAAb,GAA6B,CAAjC,EAAoC;AAChC;AACA,iBAAK/H,OAAL,CAAagI,QAAb,CAAsBrC,OAAtB,CAA8B,UAAUsC,CAAV,EAAa;AACvCA,kBAAE3E,MAAF,GAAW,KAAX;AACA2E,kBAAEC,OAAF;AACH,aAHD;AAIH;AACJ,KAtdI;AAwdLtE,aAxdK,qBAwdKnB,KAxdL,EAwdY/C,IAxdZ,EAwdkB;AACnBuC,eAAO1B,eAAP,CAAuBsG,YAAvB,CAAoCC,SAApC,CAA8C,WAA9C;AACA,YAAIpH,QAAQ,UAAZ,EAAwB;AACpBuC,mBAAO1B,eAAP,CAAuB8G,aAAvB,CAAqC,UAAUJ,WAAV,EAAuB;AACxD,oBAAIA,WAAJ,EAAiB;AACb1F,0BAAMC,OAAN,CAAc,QAAd,EAAwB,UAAU4B,KAAV,EAAiB;AACrCA,gCAAQA,QAAQ,CAAhB;AACAnB,+BAAO1B,eAAP,CAAuB6G,SAAvB,CAAiC,CAAjC,EAAoC,aAApC,EAAmDnF,OAAOC,UAAP,CAAkBtC,MAArE,EAA6E,IAA7E;AACA,4BAAI,KAAKA,MAAL,IAAe,IAAnB,EAAyB;AACrB,iCAAKA,MAAL,CAAYwC,YAAZ,CAAyBnD,GAAGU,KAA5B,EAAmC+B,MAAnC,GAA4C0B,KAA5C;AACH;AACD7B,8BAAM4F,OAAN,CAAc,EAAEvH,QAAQwD,KAAV,EAAd;AACH,qBAPuB,CAOtBzB,IAPsB,CAOjB,IAPiB,CAAxB,EAOc,KAPd;AAQH;AACJ,aAXoC,CAWnCA,IAXmC,CAW9B,IAX8B,CAArC,EAWc,KAXd;AAYH,SAbD,MAaO,IAAIjC,QAAQ,SAAZ,EAAuB;AAC1BuC,mBAAO1B,eAAP,CAAuB4H,YAAvB,CAAoC,UAAUC,WAAV,EAAuB;AACvD,oBAAIA,WAAJ,EAAiB;AACb7G,0BAAMC,OAAN,CAAc,OAAd,EAAuB,UAAU6B,IAAV,EAAgB;AACnCA,+BAAOA,OAAO,GAAd;AACApB,+BAAO1B,eAAP,CAAuB6G,SAAvB,CAAiC,EAAjC,EAAqC,MAArC,EAA6CnF,OAAOC,UAAP,CAAkBnC,KAA/D,EAAsE,IAAtE;AACA,4BAAI,KAAKA,KAAL,IAAc,IAAlB,EAAwB;AACpB,iCAAKA,KAAL,CAAWqC,YAAX,CAAwBnD,GAAGU,KAA3B,EAAkC+B,MAAlC,GAA2C2B,IAA3C;AACH;AACD9B,8BAAM4F,OAAN,CAAc,EAAEpH,OAAOsD,IAAT,EAAd;AACH,qBAPsB,CAOrB1B,IAPqB,CAOhB,IAPgB,CAAvB,EAOc,KAPd;AAQH;AACJ,aAXmC,CAWlCA,IAXkC,CAW7B,IAX6B,CAApC,EAWc,KAXd;AAYH,SAbM,MAaA,IAAIjC,QAAQ,OAAZ,EAAqB;AACxB,gBAAImE,aAAa,KAAKC,SAAL,CAAe7B,OAAOvB,MAAtB,CAAjB;AACA,gBAAIsD,WAAWH,WAAWG,QAA1B;AACA,gBAAIC,aAAa,KAAKxD,YAAL,CAAkBuD,QAAlB,CAAjB;AACA,gBAAIC,cAAc,IAAlB,EAAwB;AACpB;AACH;AACD,gBAAIjC,SAAS,GAAb;AACA,gBAAIqG,MAAMpG,OAAOvB,MAAP,GAAgBmD,WAAWG,QAArC;AACAhC,qBAASA,UAAU,CAACqG,GAAD,GAAO,CAAjB,IAAsB,EAA/B;AACA,gBAAIC,kBAAkB,KAAKrI,UAAL,CAAgBsI,kBAAhB,EAAtB;AACA,iBAAKtI,UAAL,CAAgBuI,cAAhB,CAA+BvJ,GAAGwJ,CAAH,CAAK,CAAL,EAAQH,gBAAgBI,CAAhB,GAAoBzE,WAAWyE,CAA/B,GAAmC1G,MAA3C,CAA/B,EAAmF,GAAnF;AACH,SAZM,MAYA,IAAItC,QAAQ,SAAZ,EAAuB;AAC1B,gBAAIiJ,SAAS,KAAKtH,SAAL,CAAeK,MAAxB,KAAmC,CAAvC,EAA0C;AACtC;AACH;AACD,iBAAKL,SAAL,CAAeK,MAAf,GAAwB,CAAxB;AACAH,kBAAMC,OAAN,CAAc,SAAd,EAAyB,UAAUC,KAAV,EAAiB;;AAEtC;AACAF,sBAAM4F,OAAN,CAAc,EAAEyB,SAAS,CAAX,EAAd,EAA8B,YAAY;;AAEtC;AACArH,0BAAMC,OAAN,CAAc,QAAd,EAAwB,UAAUqH,KAAV,EAAiB;AACrCA,gCAAQF,SAASE,KAAT,CAAR;AACAA,gCAAQA,QAAQpH,KAAhB;AACA,4BAAIkG,KAAKmB,GAAL,CAAS,KAAKjH,IAAL,CAAU6G,CAAV,GAAc,CAAvB,IAA4B,EAAhC,EAAoC;AAChCzG,mCAAO1B,eAAP,CAAuB6G,SAAvB,CAAiC3F,KAAjC,EAAwC,aAAxC,EAAuDQ,OAAOC,UAAP,CAAkBtC,MAAzE,EAAiF,KAAKsB,SAAL,CAAeW,IAAhG,EAAsG,YAAY;AAC9G,oCAAI,QAAQI,OAAOC,UAAP,CAAkBtC,MAA9B,EAAsC;AAClCqC,2CAAOC,UAAP,CAAkBtC,MAAlB,CAAyBwC,YAAzB,CAAsCnD,GAAGU,KAAzC,EAAgD+B,MAAhD,GAAyDmH,MAAM5F,QAAN,EAAzD;AACH;AACJ,6BAJqG,CAIpGtB,IAJoG,CAI/F,IAJ+F,CAAtG;AAKH;AACDJ,8BAAM4F,OAAN,CAAc,EAAEvH,QAAQiJ,KAAV,EAAd,EAAiC,IAAjC;AACH,qBAXuB,CAWtBlH,IAXsB,CAWjB,IAXiB,CAAxB;AAaH,iBAhB6B,CAgB5BA,IAhB4B,CAgBvB,IAhBuB,CAA9B;AAkBH,aArBwB,CAqBvBA,IArBuB,CAqBlB,IArBkB,CAAzB;AAuBH;AACJ,KA7hBI;AA+hBLC,oBA/hBK,8BA+hBc;AACf,YAAI,KAAKZ,MAAL,IAAe,CAAnB,EAAsB;AAClB,iBAAKA,MAAL,GAAc,GAAd;AACAO,kBAAMC,OAAN,CAAc,SAAd,EAAyB,UAAUC,KAAV,EAAiB;AACtCA,wBAAQA,QAAQ,CAAhB;AACA,qBAAKJ,SAAL,CAAeK,MAAf,GAAwBD,KAAxB;AACAF,sBAAM4F,OAAN,CAAc,EAAEyB,SAASnH,KAAX,EAAd;AACH,aAJwB,CAIvBE,IAJuB,CAIlB,IAJkB,CAAzB;AAKH,SAPD,MAOO;AACH,gBAAIoH,OAAO,KAAK/H,MAAhB;AACA,gBAAIgI,UAAUD,OAAO,EAArB;AACA,gBAAIE,MAAMF,OAAO,EAAP,GAAY,EAAZ,GAAiB,MAAMpB,KAAKC,KAAL,CAAWmB,OAAO,EAAlB,CAAvB,GAA+C,KAAKpB,KAAKC,KAAL,CAAWmB,OAAO,EAAlB,CAA9D;AACA,gBAAIG,MAAMH,OAAO,EAAP,GAAY,EAAZ,GAAiB,MAAMpB,KAAKC,KAAL,CAAWmB,OAAO,EAAlB,CAAvB,GAA+C,KAAKpB,KAAKC,KAAL,CAAWmB,OAAO,EAAlB,CAA9D;AACA,gBAAIA,QAAQ,CAAZ,EAAe;AACXE,sBAAM,IAAN;AACAC,sBAAM,IAAN;AACH;AACD,iBAAK9H,UAAL,CAAgBM,MAAhB,GAAyBuH,MAAM,GAAN,GAAYC,GAArC;AACH;AACD,aAAKvF,YAAL,CAAkB,YAAY;AAC1B,iBAAK/B,gBAAL;AACH,SAFiB,CAEhBD,IAFgB,CAEX,IAFW,CAAlB,EAEc,CAFd;AAGH,KArjBI;AAujBLwH,UAvjBK,kBAujBEC,EAvjBF,EAujBM;AACP,aAAKpI,MAAL,GAAc,KAAKA,MAAL,GAAcoI,EAA5B;AACH;AAzjBI,CAAT","file":"MainView.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\UI","sourcesContent":["import { isContext } from \"vm\";\r\n\r\nvar stageColor = [\r\n    cc.color(248, 181, 81, 255),\r\n    cc.color(174, 93, 161, 255),\r\n    cc.color(50, 177, 108, 255),\r\n    cc.color(54, 46, 43, 255),\r\n    cc.color(0, 0, 0, 255),\r\n    cc.color(0, 160, 233, 255),\r\n];\r\nvar gray = cc.color(229, 229, 229, 255);\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        title: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n        hearts: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        starts: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        coins: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        content: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        scrollView: {\r\n            default: null,\r\n            type: cc.ScrollView,\r\n        },\r\n        stageItem: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        missionSpriteAtlas: {\r\n            default: null,\r\n            type: cc.SpriteAtlas,\r\n        },\r\n        missions: {\r\n            default: null,\r\n        },\r\n        gameApplication: {\r\n            default: null,\r\n            type: Object\r\n        },\r\n        missionNodes: {\r\n            default: [],\r\n        },\r\n        curIdx: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n            visible: false,\r\n        },\r\n        minIdx: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n            visible: false,\r\n        },\r\n        maxIdx: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n            visible: false,\r\n        },\r\n        uiAtlas: {\r\n            default: null,\r\n            type: cc.SpriteAtlas,\r\n        },\r\n        reTime: {\r\n            default: 0,\r\n            type: cc.Float,\r\n            visible: false,\r\n        },\r\n        reviveBtn: {\r\n            default: null,\r\n            type: cc.Button,\r\n        },\r\n        reviveTime: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n        reviveNum: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.reTime = 300;\r\n        SDK().getItem(\"reHeart\", function (count) {\r\n            this.reviveNum.string = count;\r\n        }.bind(this));\r\n        this.reviveHeartCount();\r\n        this.node.width = cc.winSize.width;\r\n        this.node.height = cc.winSize.height;\r\n        window.mainScirpt = this;\r\n        this.gameApplication = cc.find(\"GameApplication\").getComponent(\"GameApplication\");\r\n        this.init();\r\n\r\n\r\n        this.scrollView.node.on(\"scroll-to-bottom\", this.scorllToBottom, this);\r\n\r\n        this.scrollView.node.on(\"scroll-to-top\", this.scorllToTop, this);\r\n\r\n        //scrollView.scrollToOffset(cc.p(maxScrollOffset.x / 2, 0), 0.1);\r\n\r\n        this.minIdx = null;\r\n        this.maxIdx = null;\r\n    },\r\n\r\n    scorllToBottom(event) {\r\n        if (this.minIdx > 0) {\r\n            this.initStage(this.minIdx - 10);\r\n        }\r\n    },\r\n\r\n    scorllToTop(event) {\r\n        if (this.maxIdx < 540) {\r\n            this.initStage(this.maxIdx + 10);\r\n        }\r\n    },\r\n\r\n    init() {\r\n        if (this.missions == null || Object.keys(this.missions).length <= 0) {\r\n            this.gameApplication.getMissions(function (results) {\r\n                this.missions = results;\r\n                this.initContents();\r\n            }.bind(this));\r\n        } else {\r\n            this.initContents();\r\n        }\r\n\r\n        SDK().getItem(\"all\", function (score) {\r\n            this.starts.getComponent(cc.Label).string = score.toString();\r\n        }.bind(this));\r\n\r\n    },\r\n\r\n    onEnable() {\r\n        if (this.missions != null && Object.keys(this.missions).length > 0) {\r\n            this.initContents();\r\n        }\r\n        this.refreashVal();\r\n    },\r\n\r\n    refreashVal() {\r\n        if (this.starts == null) {\r\n            return;\r\n        }\r\n        SDK().getItem(\"all\", function (score) {\r\n            this.starts.getComponent(cc.Label).string = score.toString();\r\n        }.bind(this));\r\n\r\n        SDK().getItem(\"hearts\", function (heart) {\r\n            this.hearts.getComponent(cc.Label).string = heart.toString();\r\n        }.bind(this));\r\n\r\n        SDK().getItem(\"coins\", function (coin) {\r\n            this.coins.getComponent(cc.Label).string = coin.toString();\r\n        }.bind(this));\r\n    },\r\n\r\n    //初始化地图\r\n    initContents() {\r\n        this.content.active = false;\r\n        if (window.lastPlay != null) {\r\n            this.initStage(window.lastPlay);\r\n            this.content.active = true;\r\n        } else {\r\n            SDK().getItem(\"curIdx\", function (val) {\r\n                if (val == null) {\r\n                    val = 0;\r\n                }\r\n                window.curIdx = val\r\n                this.initMissionItem(val);\r\n                this.content.active = true;\r\n            }.bind(this));\r\n        }\r\n    },\r\n\r\n    //第一次加载关卡\r\n    initMissionItem(val) {\r\n        var initMission;\r\n        if (val >= 10) {\r\n            this.initStage(val - 10);\r\n        }\r\n        this.initStage(val);\r\n        if (val < 540) {\r\n            this.initStage(val + 10);\r\n        }\r\n        this.scheduleOnce(function () {\r\n            this.menuClick(null, \"goCur\");\r\n        }.bind(this), 2)\r\n    },\r\n\r\n    //加载或刷新一段关卡\r\n    initStage(val) {\r\n        var curMission = this.judgeType(val);\r\n        //console.log(val);\r\n        //console.log(curMission);\r\n        var mission = this.missions[curMission.type];\r\n        var bigStage = curMission.bigStage;\r\n\r\n        var cannonNode = this.missionNodes[bigStage];\r\n        if (cannonNode == null) {\r\n            cannonNode = cc.instantiate(this.stageItem);\r\n        }\r\n\r\n        cannonNode.parent = this.content;\r\n        cannonNode.name = \"\" + bigStage\r\n        cannonNode.tag = curMission.type;\r\n\r\n        //获取大关是否解锁\r\n        SDK().getItem(\"lock_\" + bigStage, function (lockCount) {\r\n            var islock = false;\r\n            if (lockCount > 0) {\r\n                islock = false;\r\n            }\r\n            if (bigStage == 0) {\r\n                islock = false;\r\n            }\r\n            //获取每十关的小关卡并初始化\r\n            for (var i = 0; i < 10; i = i + 1) {\r\n                //获取单个小关卡并计算小关卡是第几关\r\n                var item = cc.find(\"Bg/Stage\" + i, cannonNode);\r\n                var val = i + bigStage;\r\n\r\n                //判断章节和关卡\r\n                let mlInfo = this.judgeML(curMission, i);\r\n                //console.log(mlInfo)\r\n\r\n                item.tag = val;\r\n\r\n                //如果该小关不存在则隐藏\r\n                if (mlInfo.lid > mission.stars) {\r\n                    item.active = false;\r\n                } else {\r\n                    item.active = true;\r\n\r\n                    //获取当前小关卡的所有组件\r\n                    var small = cc.find(\"Small\", item).getComponent(cc.Sprite);\r\n                    var num = cc.find(\"Num\", small.node).getComponent(cc.Label);\r\n                    var curPoint = cc.find(\"CurPoint\", small.node);\r\n                    var lock = cc.find(\"Lock\", small.node);\r\n\r\n                    //设置关卡名\r\n                    if (val % 10 == 0) {\r\n                        num.string = \"\";\r\n                        if (val == 0) {\r\n                            num.string = \"\";\r\n                        }\r\n                    } else {\r\n                        num.string = val;\r\n                    }\r\n\r\n                    //判断是否是当前关卡\r\n                    if (val == window.curIdx) {\r\n                        curPoint.active = true;\r\n                        curPoint.runAction(\r\n                            cc.repeatForever(\r\n                                cc.sequence(\r\n                                    cc.moveBy(0.5, cc.v2(0, 20)),\r\n                                    cc.moveBy(0.5, cc.v2(0, -20))\r\n                                )\r\n                            )\r\n                        )\r\n                        //预加载关卡\r\n                        var mid = mlInfo.mid;\r\n                        var lid = mlInfo.lid;\r\n                        if (mid != null && mid > 0 && lid != null && lid > 0) {\r\n                            //预加载上下两关\r\n                            var arr = [];\r\n                            if (lid > 1) {\r\n                                arr.push(lid - 1);\r\n                            }\r\n                            arr.push(lid);\r\n                            if (lid < 100) {\r\n                                arr.push(lid + 1);\r\n                            }\r\n                            arr.forEach(function (tmp_lid) {\r\n                                var tmp_path = \"conf/level_detail/b_\" + 1 + \"/\" + mid + \"/\" + tmp_lid;\r\n                                window.gameApplication.getConf(tmp_path, null);\r\n                            });\r\n                        }\r\n                    } else {\r\n                        curPoint.stopAllActions();\r\n                        curPoint.active = false;\r\n                    }\r\n\r\n                    //设置图标的样式\r\n                    if (val == bigStage) {\r\n                        small.spriteFrame = this.uiAtlas.getSpriteFrame(curMission.type + \"Big\");\r\n                        small.node.color = cc.color(255,255,255,255);\r\n                    } else {\r\n                        small.node.color = gray;\r\n                    }\r\n\r\n                    //是否解锁\r\n                    if (!islock) {\r\n                        lock.active = false;\r\n\r\n                        //封装关卡信息\r\n                        var info = {};\r\n                        info.mid = mlInfo.mid;\r\n                        info.lid = mlInfo.lid;\r\n                        info.bigStage = curMission.bigStage;\r\n                        info.idx = i;\r\n\r\n                        //初始化按钮事件\r\n                        if (val <= window.curIdx || true) {\r\n                            this.initStageClick(info, item, islock);\r\n                        }\r\n                        this.checkstagePass(mlInfo, val, small, curMission)\r\n                    } else {\r\n                        lock.active = true;\r\n                        //解绑点击函数\r\n                        item.off(cc.Node.EventType.TOUCH_END);\r\n                        if (val % 10 == 0) {\r\n                            lock.active = false;\r\n                            var info = {};\r\n                            info.mid = mlInfo.mid;\r\n                            info.lid = mlInfo.lid;\r\n                            info.bigStage = curMission.bigStage;\r\n                            info.idx = i;\r\n                            this.initStageClick(info, item, islock);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            cannonNode.active = true;\r\n            this.missionNodes[bigStage] = cannonNode;\r\n\r\n            if (bigStage > this.maxIdx || this.maxIdx == null) {\r\n                this.maxIdx = bigStage;\r\n            }\r\n            if (bigStage < this.minIdx || this.minIdx == null) {\r\n                this.minIdx = bigStage;\r\n                cannonNode.setSiblingIndex(0);\r\n            }\r\n        }.bind(this))\r\n    },\r\n\r\n    //判断小关卡是否过关\r\n    checkstagePass(mlInfo, val, small, curMission) {\r\n        //判断是否过关\r\n        SDK().getItem(\"1_\" + mlInfo.mid + \"_\" + mlInfo.lid, function (star) {\r\n            //console.log(mlInfo.mid, mlInfo.lid, star)\r\n            if (star > 0) {\r\n                if (val % 10 != 0) {\r\n                    small.node.color = stageColor[curMission.type];\r\n                }\r\n            }\r\n        }.bind(this))\r\n    },\r\n\r\n\r\n    initStageClick(stageInfo, item, islock) {\r\n        let goGame = cc.find(\"GoGame\", this.node)\r\n        item.off(cc.Node.EventType.TOUCH_END);\r\n        //绑定点击函数\r\n        item.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            if (goGame != null) {\r\n                goGame.active = true;\r\n            }\r\n            this.gameApplication.soundManager.playSound(\"btn_click\");\r\n            var idx = event.target.tag;\r\n            //被锁住的大关卡的解锁\r\n            if (idx % 10 == 0 && idx != 0 && islock) {\r\n                this.gameApplication.showSharaView(function (isComplited) {\r\n                    if (isComplited) {\r\n                        var param = {};\r\n                        param[\"lock_\" + stageInfo.bigStage] = 1;\r\n                        SDK().setItem(param, function () {\r\n                            this.initStage(stageInfo.bigStage);\r\n                        }.bind(this))\r\n                    }\r\n                    if (goGame != null) {\r\n                        goGame.active = false;\r\n                    }\r\n                }.bind(this))\r\n            } else {\r\n                SDK().getItem(\"hearts\", function (heart) {\r\n                    //体力充足\r\n                    if (heart > 0) {\r\n                        //消耗一个体力\r\n                        heart = heart - 1;\r\n                        SDK().setItem({ hearts: heart });\r\n                        if (this.hearts != null) {\r\n                            this.hearts.getComponent(cc.Label).string = heart;\r\n                        }\r\n                        window.gameApplication.flyReward(1, \"heartSprite\", item, this.hearts, function () {\r\n                            this.goGame(stageInfo, item, islock);\r\n                        }.bind(this))\r\n                    } else {\r\n                        //体力不足需要获得\r\n                        window.gameApplication.showHeartView(function (isComplited) {\r\n                            if (isComplited) {\r\n                                heart = 4;\r\n                                if (this.hearts != null) {\r\n                                    this.hearts.getComponent(cc.Label).string = heart;\r\n                                }\r\n                                SDK().setItem({ hearts: heart });\r\n                                window.gameApplication.flyReward(1, \"heartSprite\", item, this.hearts, function () {\r\n                                    this.goGame(stageInfo, item, islock);\r\n                                }.bind(this))\r\n                            } else {\r\n                                if (goGame != null) {\r\n                                    goGame.active = false;\r\n                                }\r\n                            }\r\n                        }.bind(this), false)\r\n                    }\r\n                }.bind(this));\r\n            }\r\n        }, this);\r\n    },\r\n\r\n    goGame(stageInfo, item, islock) {\r\n        //开始游戏\r\n        window.bid = 1;\r\n        window.mid = stageInfo.mid;\r\n        window.lid = stageInfo.lid;\r\n        this.gameApplication.openGameView();\r\n    },\r\n\r\n    //判断关卡类型\r\n    judgeType(stage) {\r\n        var count = 0;\r\n        var disVal = 60;\r\n        var isFix = false;\r\n\r\n        //如果关卡大于300时，直接不要第六章节\r\n        if (stage >= 300) {\r\n            stage = stage - 300;\r\n            isFix = true;\r\n            disVal = 50;\r\n        }\r\n        while (stage >= disVal) {\r\n            stage = stage - disVal;\r\n            count = count + 1;\r\n        }\r\n        stage = Math.floor(stage / 10);\r\n\r\n        var param = {};\r\n        param.type = stage;\r\n        param.count = count;\r\n        param.bigStage = (stage * 10) + (count * disVal);\r\n        if (isFix) {\r\n            param.bigStage = param.bigStage + 300;\r\n        }\r\n        return param;\r\n    },\r\n\r\n    //根据关卡数判断mid 和 lid\r\n    judgeML(curMission, i) {\r\n        var info = {};\r\n        info.mid = curMission.type + 1;\r\n        var fixCount = 0;\r\n        if (curMission.bigStage >= 300) {\r\n            fixCount = 5;\r\n        }\r\n        info.lid = 1 + i + ((fixCount + curMission.count) * 10);\r\n        return info;\r\n    },\r\n\r\n    hideAllItem() {\r\n        if (this.content.childrenCount > 0) {\r\n            //如果有child，destroy\r\n            this.content.children.forEach(function (n) {\r\n                n.active = false;\r\n                n.destroy();\r\n            });\r\n        }\r\n    },\r\n\r\n    menuClick(event, type) {\r\n        window.gameApplication.soundManager.playSound(\"btn_click\")\r\n        if (type == \"addHeart\") {\r\n            window.gameApplication.showHeartView(function (isComplited) {\r\n                if (isComplited) {\r\n                    SDK().getItem(\"hearts\", function (heart) {\r\n                        heart = heart + 5;\r\n                        window.gameApplication.flyReward(5, \"heartSprite\", window.mainScirpt.hearts, null);\r\n                        if (this.hearts != null) {\r\n                            this.hearts.getComponent(cc.Label).string = heart;\r\n                        }\r\n                        SDK().setItem({ hearts: heart });\r\n                    }.bind(this), false)\r\n                }\r\n            }.bind(this), false)\r\n        } else if (type == \"addCoin\") {\r\n            window.gameApplication.showCoinView(function (isCompleted) {\r\n                if (isCompleted) {\r\n                    SDK().getItem(\"coins\", function (coin) {\r\n                        coin = coin + 100;\r\n                        window.gameApplication.flyReward(10, \"coin\", window.mainScirpt.coins, null);\r\n                        if (this.coins != null) {\r\n                            this.coins.getComponent(cc.Label).string = coin;\r\n                        }\r\n                        SDK().setItem({ coins: coin });\r\n                    }.bind(this), false)\r\n                }\r\n            }.bind(this), false)\r\n        } else if (type == \"goCur\") {\r\n            var curMission = this.judgeType(window.curIdx);\r\n            var bigStage = curMission.bigStage;\r\n            var cannonNode = this.missionNodes[bigStage];\r\n            if (cannonNode == null) {\r\n                return;\r\n            }\r\n            var height = 995;\r\n            var fix = window.curIdx - curMission.bigStage;\r\n            height = height * (-fix + 5) / 10;\r\n            var maxScrollOffset = this.scrollView.getMaxScrollOffset();\r\n            this.scrollView.scrollToOffset(cc.p(0, maxScrollOffset.y - cannonNode.y + height), 0.5);\r\n        } else if (type == \"reHeart\") {\r\n            if (parseInt(this.reviveNum.string) == 0) {\r\n                return;\r\n            }\r\n            this.reviveNum.string = 0;\r\n            SDK().getItem(\"reHeart\", function (count) {\r\n\r\n                //将可获得的体力置零\r\n                SDK().setItem({ reHeart: 0 }, function () {\r\n\r\n                    //增加体力\r\n                    SDK().getItem(\"hearts\", function (Heart) {\r\n                        Heart = parseInt(Heart);\r\n                        Heart = Heart + count;\r\n                        if (Math.abs(this.node.y - 0) < 10) {\r\n                            window.gameApplication.flyReward(count, \"heartSprite\", window.mainScirpt.hearts, this.reviveBtn.node, function () {\r\n                                if (null != window.mainScirpt.hearts) {\r\n                                    window.mainScirpt.hearts.getComponent(cc.Label).string = Heart.toString();\r\n                                }\r\n                            }.bind(this));\r\n                        }\r\n                        SDK().setItem({ hearts: Heart }, null);\r\n                    }.bind(this));\r\n\r\n                }.bind(this));\r\n\r\n            }.bind(this));\r\n\r\n        }\r\n    },\r\n\r\n    reviveHeartCount() {\r\n        if (this.reTime <= 0) {\r\n            this.reTime = 300;\r\n            SDK().getItem(\"reHeart\", function (count) {\r\n                count = count + 1;\r\n                this.reviveNum.string = count;\r\n                SDK().setItem({ reHeart: count });\r\n            }.bind(this));\r\n        } else {\r\n            var temp = this.reTime;\r\n            var tempMin = temp / 60;\r\n            var min = temp / 60 < 10 ? \"0\" + Math.floor(temp / 60) : \"\" + Math.floor(temp / 60);\r\n            var sec = temp % 60 < 10 ? \"0\" + Math.floor(temp % 60) : \"\" + Math.floor(temp % 60);\r\n            if (temp <= 0) {\r\n                min = \"00\";\r\n                sec = \"00\"\r\n            }\r\n            this.reviveTime.string = min + \":\" + sec;\r\n        }\r\n        this.scheduleOnce(function () {\r\n            this.reviveHeartCount();\r\n        }.bind(this), 1)\r\n    },\r\n\r\n    update(dt) {\r\n        this.reTime = this.reTime - dt;\r\n    },\r\n});\r\n"]}